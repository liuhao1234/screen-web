{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport './media/tree.css';\nimport { dispose, Disposable, toDisposable, DisposableStore } from '../../../common/lifecycle.js';\nimport { List, MouseController, DefaultKeyboardNavigationDelegate } from '../list/listWidget.js';\nimport { append, $, toggleClass, getDomNodePagePosition, removeClass, addClass, hasClass, createStyleSheet, clearNode, addClasses, removeClasses } from '../../dom.js';\nimport { Event, Relay, Emitter, EventBufferer } from '../../../common/event.js';\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\nimport { StaticDND, DragAndDropData } from '../../dnd.js';\nimport { range, equals, distinctES6, fromSet } from '../../../common/arrays.js';\nimport { ElementsDragAndDropData } from '../list/listView.js';\nimport { domEvent } from '../../event.js';\nimport { fuzzyScore, FuzzyScore } from '../../../common/filters.js';\nimport { getVisibleState, isFilterResult } from './indexTreeModel.js';\nimport { localize } from '../../../../nls.js';\nimport { disposableTimeout } from '../../../common/async.js';\nimport { isMacintosh } from '../../../common/platform.js';\nimport { values } from '../../../common/map.js';\nimport { clamp } from '../../../common/numbers.js';\nimport { SetMap } from '../../../common/collections.js';\n\nvar TreeElementsDragAndDropData =\n/** @class */\nfunction (_super) {\n  __extends(TreeElementsDragAndDropData, _super);\n\n  function TreeElementsDragAndDropData(data) {\n    var _this = _super.call(this, data.elements.map(function (node) {\n      return node.element;\n    })) || this;\n\n    _this.data = data;\n    return _this;\n  }\n\n  return TreeElementsDragAndDropData;\n}(ElementsDragAndDropData);\n\nfunction asTreeDragAndDropData(data) {\n  if (data instanceof ElementsDragAndDropData) {\n    return new TreeElementsDragAndDropData(data);\n  }\n\n  return data;\n}\n\nvar TreeNodeListDragAndDrop =\n/** @class */\nfunction () {\n  function TreeNodeListDragAndDrop(modelProvider, dnd) {\n    this.modelProvider = modelProvider;\n    this.dnd = dnd;\n    this.autoExpandDisposable = Disposable.None;\n  }\n\n  TreeNodeListDragAndDrop.prototype.getDragURI = function (node) {\n    return this.dnd.getDragURI(node.element);\n  };\n\n  TreeNodeListDragAndDrop.prototype.getDragLabel = function (nodes, originalEvent) {\n    if (this.dnd.getDragLabel) {\n      return this.dnd.getDragLabel(nodes.map(function (node) {\n        return node.element;\n      }), originalEvent);\n    }\n\n    return undefined;\n  };\n\n  TreeNodeListDragAndDrop.prototype.onDragStart = function (data, originalEvent) {\n    if (this.dnd.onDragStart) {\n      this.dnd.onDragStart(asTreeDragAndDropData(data), originalEvent);\n    }\n  };\n\n  TreeNodeListDragAndDrop.prototype.onDragOver = function (data, targetNode, targetIndex, originalEvent, raw) {\n    var _this = this;\n\n    if (raw === void 0) {\n      raw = true;\n    }\n\n    var result = this.dnd.onDragOver(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n    var didChangeAutoExpandNode = this.autoExpandNode !== targetNode;\n\n    if (didChangeAutoExpandNode) {\n      this.autoExpandDisposable.dispose();\n      this.autoExpandNode = targetNode;\n    }\n\n    if (typeof targetNode === 'undefined') {\n      return result;\n    }\n\n    if (didChangeAutoExpandNode && typeof result !== 'boolean' && result.autoExpand) {\n      this.autoExpandDisposable = disposableTimeout(function () {\n        var model = _this.modelProvider();\n\n        var ref = model.getNodeLocation(targetNode);\n\n        if (model.isCollapsed(ref)) {\n          model.setCollapsed(ref, false);\n        }\n\n        _this.autoExpandNode = undefined;\n      }, 500);\n    }\n\n    if (typeof result === 'boolean' || !result.accept || typeof result.bubble === 'undefined' || result.feedback) {\n      if (!raw) {\n        var accept = typeof result === 'boolean' ? result : result.accept;\n        var effect = typeof result === 'boolean' ? undefined : result.effect;\n        return {\n          accept: accept,\n          effect: effect,\n          feedback: [targetIndex]\n        };\n      }\n\n      return result;\n    }\n\n    if (result.bubble === 1\n    /* Up */\n    ) {\n        var model_1 = this.modelProvider();\n        var ref_1 = model_1.getNodeLocation(targetNode);\n        var parentRef = model_1.getParentNodeLocation(ref_1);\n        var parentNode = model_1.getNode(parentRef);\n        var parentIndex = parentRef && model_1.getListIndex(parentRef);\n        return this.onDragOver(data, parentNode, parentIndex, originalEvent, false);\n      }\n\n    var model = this.modelProvider();\n    var ref = model.getNodeLocation(targetNode);\n    var start = model.getListIndex(ref);\n    var length = model.getListRenderCount(ref);\n    return __assign(__assign({}, result), {\n      feedback: range(start, start + length)\n    });\n  };\n\n  TreeNodeListDragAndDrop.prototype.drop = function (data, targetNode, targetIndex, originalEvent) {\n    this.autoExpandDisposable.dispose();\n    this.autoExpandNode = undefined;\n    this.dnd.drop(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n  };\n\n  TreeNodeListDragAndDrop.prototype.onDragEnd = function (originalEvent) {\n    if (this.dnd.onDragEnd) {\n      this.dnd.onDragEnd(originalEvent);\n    }\n  };\n\n  return TreeNodeListDragAndDrop;\n}();\n\nfunction asListOptions(modelProvider, options) {\n  return options && __assign(__assign({}, options), {\n    identityProvider: options.identityProvider && {\n      getId: function (el) {\n        return options.identityProvider.getId(el.element);\n      }\n    },\n    dnd: options.dnd && new TreeNodeListDragAndDrop(modelProvider, options.dnd),\n    multipleSelectionController: options.multipleSelectionController && {\n      isSelectionSingleChangeEvent: function (e) {\n        return options.multipleSelectionController.isSelectionSingleChangeEvent(__assign(__assign({}, e), {\n          element: e.element\n        }));\n      },\n      isSelectionRangeChangeEvent: function (e) {\n        return options.multipleSelectionController.isSelectionRangeChangeEvent(__assign(__assign({}, e), {\n          element: e.element\n        }));\n      }\n    },\n    accessibilityProvider: options.accessibilityProvider && __assign(__assign({}, options.accessibilityProvider), {\n      getAriaLabel: function (e) {\n        return options.accessibilityProvider.getAriaLabel(e.element);\n      },\n      getAriaLevel: function (node) {\n        return node.depth;\n      },\n      getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && function (node) {\n        return options.accessibilityProvider.getActiveDescendantId(node.element);\n      }\n    }),\n    keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && __assign(__assign({}, options.keyboardNavigationLabelProvider), {\n      getKeyboardNavigationLabel: function (node) {\n        return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(node.element);\n      }\n    }),\n    enableKeyboardNavigation: options.simpleKeyboardNavigation,\n    ariaProvider: {\n      getSetSize: function (node) {\n        var model = modelProvider();\n        var ref = model.getNodeLocation(node);\n        var parentRef = model.getParentNodeLocation(ref);\n        var parentNode = model.getNode(parentRef);\n        return parentNode.visibleChildrenCount;\n      },\n      getPosInSet: function (node) {\n        return node.visibleChildIndex + 1;\n      },\n      isChecked: options.ariaProvider && options.ariaProvider.isChecked ? function (node) {\n        return options.ariaProvider.isChecked(node.element);\n      } : undefined,\n      getRole: options.ariaProvider && options.ariaProvider.getRole ? function (node) {\n        return options.ariaProvider.getRole(node.element);\n      } : undefined\n    }\n  });\n}\n\nvar ComposedTreeDelegate =\n/** @class */\nfunction () {\n  function ComposedTreeDelegate(delegate) {\n    this.delegate = delegate;\n  }\n\n  ComposedTreeDelegate.prototype.getHeight = function (element) {\n    return this.delegate.getHeight(element.element);\n  };\n\n  ComposedTreeDelegate.prototype.getTemplateId = function (element) {\n    return this.delegate.getTemplateId(element.element);\n  };\n\n  ComposedTreeDelegate.prototype.hasDynamicHeight = function (element) {\n    return !!this.delegate.hasDynamicHeight && this.delegate.hasDynamicHeight(element.element);\n  };\n\n  ComposedTreeDelegate.prototype.setDynamicHeight = function (element, height) {\n    if (this.delegate.setDynamicHeight) {\n      this.delegate.setDynamicHeight(element.element, height);\n    }\n  };\n\n  return ComposedTreeDelegate;\n}();\n\nexport { ComposedTreeDelegate };\nexport var RenderIndentGuides;\n\n(function (RenderIndentGuides) {\n  RenderIndentGuides[\"None\"] = \"none\";\n  RenderIndentGuides[\"OnHover\"] = \"onHover\";\n  RenderIndentGuides[\"Always\"] = \"always\";\n})(RenderIndentGuides || (RenderIndentGuides = {}));\n\nvar EventCollection =\n/** @class */\nfunction () {\n  function EventCollection(onDidChange, _elements) {\n    var _this = this;\n\n    if (_elements === void 0) {\n      _elements = [];\n    }\n\n    this._elements = _elements;\n    this.onDidChange = Event.forEach(onDidChange, function (elements) {\n      return _this._elements = elements;\n    });\n  }\n\n  Object.defineProperty(EventCollection.prototype, \"elements\", {\n    get: function () {\n      return this._elements;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return EventCollection;\n}();\n\nvar TreeRenderer =\n/** @class */\nfunction () {\n  function TreeRenderer(renderer, modelProvider, onDidChangeCollapseState, activeNodes, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    this.renderer = renderer;\n    this.modelProvider = modelProvider;\n    this.activeNodes = activeNodes;\n    this.renderedElements = new Map();\n    this.renderedNodes = new Map();\n    this.indent = TreeRenderer.DefaultIndent;\n    this.hideTwistiesOfChildlessElements = false;\n    this.shouldRenderIndentGuides = false;\n    this.renderedIndentGuides = new SetMap();\n    this.activeIndentNodes = new Set();\n    this.indentGuidesDisposable = Disposable.None;\n    this.disposables = new DisposableStore();\n    this.templateId = renderer.templateId;\n    this.updateOptions(options);\n    Event.map(onDidChangeCollapseState, function (e) {\n      return e.node;\n    })(this.onDidChangeNodeTwistieState, this, this.disposables);\n\n    if (renderer.onDidChangeTwistieState) {\n      renderer.onDidChangeTwistieState(this.onDidChangeTwistieState, this, this.disposables);\n    }\n  }\n\n  TreeRenderer.prototype.updateOptions = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    if (typeof options.indent !== 'undefined') {\n      this.indent = clamp(options.indent, 0, 40);\n    }\n\n    if (typeof options.renderIndentGuides !== 'undefined') {\n      var shouldRenderIndentGuides = options.renderIndentGuides !== RenderIndentGuides.None;\n\n      if (shouldRenderIndentGuides !== this.shouldRenderIndentGuides) {\n        this.shouldRenderIndentGuides = shouldRenderIndentGuides;\n        this.indentGuidesDisposable.dispose();\n\n        if (shouldRenderIndentGuides) {\n          var disposables = new DisposableStore();\n          this.activeNodes.onDidChange(this._onDidChangeActiveNodes, this, disposables);\n          this.indentGuidesDisposable = disposables;\n\n          this._onDidChangeActiveNodes(this.activeNodes.elements);\n        }\n      }\n    }\n\n    if (typeof options.hideTwistiesOfChildlessElements !== 'undefined') {\n      this.hideTwistiesOfChildlessElements = options.hideTwistiesOfChildlessElements;\n    }\n  };\n\n  TreeRenderer.prototype.renderTemplate = function (container) {\n    var el = append(container, $('.monaco-tl-row'));\n    var indent = append(el, $('.monaco-tl-indent'));\n    var twistie = append(el, $('.monaco-tl-twistie'));\n    var contents = append(el, $('.monaco-tl-contents'));\n    var templateData = this.renderer.renderTemplate(contents);\n    return {\n      container: container,\n      indent: indent,\n      twistie: twistie,\n      indentGuidesDisposable: Disposable.None,\n      templateData: templateData\n    };\n  };\n\n  TreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\n    if (typeof height === 'number') {\n      this.renderedNodes.set(node, {\n        templateData: templateData,\n        height: height\n      });\n      this.renderedElements.set(node.element, node);\n    }\n\n    var indent = TreeRenderer.DefaultIndent + (node.depth - 1) * this.indent;\n    templateData.twistie.style.paddingLeft = indent + \"px\";\n    templateData.indent.style.width = indent + this.indent - 16 + \"px\";\n    this.renderTwistie(node, templateData);\n\n    if (typeof height === 'number') {\n      this.renderIndentGuides(node, templateData);\n    }\n\n    this.renderer.renderElement(node, index, templateData.templateData, height);\n  };\n\n  TreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\n    templateData.indentGuidesDisposable.dispose();\n\n    if (this.renderer.disposeElement) {\n      this.renderer.disposeElement(node, index, templateData.templateData, height);\n    }\n\n    if (typeof height === 'number') {\n      this.renderedNodes.delete(node);\n      this.renderedElements.delete(node.element);\n    }\n  };\n\n  TreeRenderer.prototype.disposeTemplate = function (templateData) {\n    this.renderer.disposeTemplate(templateData.templateData);\n  };\n\n  TreeRenderer.prototype.onDidChangeTwistieState = function (element) {\n    var node = this.renderedElements.get(element);\n\n    if (!node) {\n      return;\n    }\n\n    this.onDidChangeNodeTwistieState(node);\n  };\n\n  TreeRenderer.prototype.onDidChangeNodeTwistieState = function (node) {\n    var data = this.renderedNodes.get(node);\n\n    if (!data) {\n      return;\n    }\n\n    this.renderTwistie(node, data.templateData);\n\n    this._onDidChangeActiveNodes(this.activeNodes.elements);\n\n    this.renderIndentGuides(node, data.templateData);\n  };\n\n  TreeRenderer.prototype.renderTwistie = function (node, templateData) {\n    if (this.renderer.renderTwistie) {\n      this.renderer.renderTwistie(node.element, templateData.twistie);\n    }\n\n    if (node.collapsible && (!this.hideTwistiesOfChildlessElements || node.visibleChildrenCount > 0)) {\n      addClasses(templateData.twistie, 'codicon', 'codicon-chevron-down', 'collapsible');\n      toggleClass(templateData.twistie, 'collapsed', node.collapsed);\n    } else {\n      removeClasses(templateData.twistie, 'codicon', 'codicon-chevron-down', 'collapsible', 'collapsed');\n    }\n\n    if (node.collapsible) {\n      templateData.container.setAttribute('aria-expanded', String(!node.collapsed));\n    } else {\n      templateData.container.removeAttribute('aria-expanded');\n    }\n  };\n\n  TreeRenderer.prototype.renderIndentGuides = function (target, templateData) {\n    var _this = this;\n\n    clearNode(templateData.indent);\n    templateData.indentGuidesDisposable.dispose();\n\n    if (!this.shouldRenderIndentGuides) {\n      return;\n    }\n\n    var disposableStore = new DisposableStore();\n    var model = this.modelProvider();\n    var node = target;\n\n    var _loop_1 = function () {\n      var ref = model.getNodeLocation(node);\n      var parentRef = model.getParentNodeLocation(ref);\n\n      if (!parentRef) {\n        return \"break\";\n      }\n\n      var parent_1 = model.getNode(parentRef);\n      var guide = $('.indent-guide', {\n        style: \"width: \" + this_1.indent + \"px\"\n      });\n\n      if (this_1.activeIndentNodes.has(parent_1)) {\n        addClass(guide, 'active');\n      }\n\n      if (templateData.indent.childElementCount === 0) {\n        templateData.indent.appendChild(guide);\n      } else {\n        templateData.indent.insertBefore(guide, templateData.indent.firstElementChild);\n      }\n\n      this_1.renderedIndentGuides.add(parent_1, guide);\n      disposableStore.add(toDisposable(function () {\n        return _this.renderedIndentGuides.delete(parent_1, guide);\n      }));\n      node = parent_1;\n    };\n\n    var this_1 = this;\n\n    while (true) {\n      var state_1 = _loop_1();\n\n      if (state_1 === \"break\") break;\n    }\n\n    templateData.indentGuidesDisposable = disposableStore;\n  };\n\n  TreeRenderer.prototype._onDidChangeActiveNodes = function (nodes) {\n    var _this = this;\n\n    if (!this.shouldRenderIndentGuides) {\n      return;\n    }\n\n    var set = new Set();\n    var model = this.modelProvider();\n    nodes.forEach(function (node) {\n      var ref = model.getNodeLocation(node);\n\n      try {\n        var parentRef = model.getParentNodeLocation(ref);\n\n        if (node.collapsible && node.children.length > 0 && !node.collapsed) {\n          set.add(node);\n        } else if (parentRef) {\n          set.add(model.getNode(parentRef));\n        }\n      } catch (_a) {// noop\n      }\n    });\n    this.activeIndentNodes.forEach(function (node) {\n      if (!set.has(node)) {\n        _this.renderedIndentGuides.forEach(node, function (line) {\n          return removeClass(line, 'active');\n        });\n      }\n    });\n    set.forEach(function (node) {\n      if (!_this.activeIndentNodes.has(node)) {\n        _this.renderedIndentGuides.forEach(node, function (line) {\n          return addClass(line, 'active');\n        });\n      }\n    });\n    this.activeIndentNodes = set;\n  };\n\n  TreeRenderer.prototype.dispose = function () {\n    this.renderedNodes.clear();\n    this.renderedElements.clear();\n    this.indentGuidesDisposable.dispose();\n    dispose(this.disposables);\n  };\n\n  TreeRenderer.DefaultIndent = 8;\n  return TreeRenderer;\n}();\n\nvar TypeFilter =\n/** @class */\nfunction () {\n  function TypeFilter(tree, keyboardNavigationLabelProvider, _filter) {\n    this.tree = tree;\n    this.keyboardNavigationLabelProvider = keyboardNavigationLabelProvider;\n    this._filter = _filter;\n    this._totalCount = 0;\n    this._matchCount = 0;\n    this._pattern = '';\n    this._lowercasePattern = '';\n    this.disposables = new DisposableStore();\n    tree.onWillRefilter(this.reset, this, this.disposables);\n  }\n\n  Object.defineProperty(TypeFilter.prototype, \"totalCount\", {\n    get: function () {\n      return this._totalCount;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeFilter.prototype, \"matchCount\", {\n    get: function () {\n      return this._matchCount;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeFilter.prototype, \"pattern\", {\n    set: function (pattern) {\n      this._pattern = pattern;\n      this._lowercasePattern = pattern.toLowerCase();\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  TypeFilter.prototype.filter = function (element, parentVisibility) {\n    if (this._filter) {\n      var result = this._filter.filter(element, parentVisibility);\n\n      if (this.tree.options.simpleKeyboardNavigation) {\n        return result;\n      }\n\n      var visibility = void 0;\n\n      if (typeof result === 'boolean') {\n        visibility = result ? 1\n        /* Visible */\n        : 0\n        /* Hidden */\n        ;\n      } else if (isFilterResult(result)) {\n        visibility = getVisibleState(result.visibility);\n      } else {\n        visibility = result;\n      }\n\n      if (visibility === 0\n      /* Hidden */\n      ) {\n          return false;\n        }\n    }\n\n    this._totalCount++;\n\n    if (this.tree.options.simpleKeyboardNavigation || !this._pattern) {\n      this._matchCount++;\n      return {\n        data: FuzzyScore.Default,\n        visibility: true\n      };\n    }\n\n    var label = this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(element);\n    var labelStr = label && label.toString();\n\n    if (typeof labelStr === 'undefined') {\n      return {\n        data: FuzzyScore.Default,\n        visibility: true\n      };\n    }\n\n    var score = fuzzyScore(this._pattern, this._lowercasePattern, 0, labelStr, labelStr.toLowerCase(), 0, true);\n\n    if (!score) {\n      if (this.tree.options.filterOnType) {\n        return 2\n        /* Recurse */\n        ;\n      } else {\n        return {\n          data: FuzzyScore.Default,\n          visibility: true\n        };\n      } // DEMO: smarter filter ?\n      // return parentVisibility === TreeVisibility.Visible ? true : TreeVisibility.Recurse;\n\n    }\n\n    this._matchCount++;\n    return {\n      data: score,\n      visibility: true\n    };\n  };\n\n  TypeFilter.prototype.reset = function () {\n    this._totalCount = 0;\n    this._matchCount = 0;\n  };\n\n  TypeFilter.prototype.dispose = function () {\n    dispose(this.disposables);\n  };\n\n  return TypeFilter;\n}();\n\nvar TypeFilterController =\n/** @class */\nfunction () {\n  function TypeFilterController(tree, model, view, filter, keyboardNavigationDelegate) {\n    this.tree = tree;\n    this.view = view;\n    this.filter = filter;\n    this.keyboardNavigationDelegate = keyboardNavigationDelegate;\n    this._enabled = false;\n    this._pattern = '';\n    this._empty = false;\n    this._onDidChangeEmptyState = new Emitter();\n    this.positionClassName = 'ne';\n    this.automaticKeyboardNavigation = true;\n    this.triggered = false;\n    this._onDidChangePattern = new Emitter();\n    this.enabledDisposables = new DisposableStore();\n    this.disposables = new DisposableStore();\n    this.domNode = $(\".monaco-list-type-filter.\" + this.positionClassName);\n    this.domNode.draggable = true;\n    domEvent(this.domNode, 'dragstart')(this.onDragStart, this, this.disposables);\n    this.messageDomNode = append(view.getHTMLElement(), $(\".monaco-list-type-filter-message\"));\n    this.labelDomNode = append(this.domNode, $('span.label'));\n    var controls = append(this.domNode, $('.controls'));\n    this._filterOnType = !!tree.options.filterOnType;\n    this.filterOnTypeDomNode = append(controls, $('input.filter.codicon.codicon-list-selection'));\n    this.filterOnTypeDomNode.type = 'checkbox';\n    this.filterOnTypeDomNode.checked = this._filterOnType;\n    this.filterOnTypeDomNode.tabIndex = -1;\n    this.updateFilterOnTypeTitle();\n    domEvent(this.filterOnTypeDomNode, 'input')(this.onDidChangeFilterOnType, this, this.disposables);\n    this.clearDomNode = append(controls, $('button.clear.codicon.codicon-close'));\n    this.clearDomNode.tabIndex = -1;\n    this.clearDomNode.title = localize('clear', \"Clear\");\n    this.keyboardNavigationEventFilter = tree.options.keyboardNavigationEventFilter;\n    model.onDidSplice(this.onDidSpliceModel, this, this.disposables);\n    this.updateOptions(tree.options);\n  }\n\n  Object.defineProperty(TypeFilterController.prototype, \"enabled\", {\n    get: function () {\n      return this._enabled;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeFilterController.prototype, \"pattern\", {\n    get: function () {\n      return this._pattern;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeFilterController.prototype, \"filterOnType\", {\n    get: function () {\n      return this._filterOnType;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  TypeFilterController.prototype.updateOptions = function (options) {\n    if (options.simpleKeyboardNavigation) {\n      this.disable();\n    } else {\n      this.enable();\n    }\n\n    if (typeof options.filterOnType !== 'undefined') {\n      this._filterOnType = !!options.filterOnType;\n      this.filterOnTypeDomNode.checked = this._filterOnType;\n    }\n\n    if (typeof options.automaticKeyboardNavigation !== 'undefined') {\n      this.automaticKeyboardNavigation = options.automaticKeyboardNavigation;\n    }\n\n    this.tree.refilter();\n    this.render();\n\n    if (!this.automaticKeyboardNavigation) {\n      this.onEventOrInput('');\n    }\n  };\n\n  TypeFilterController.prototype.enable = function () {\n    var _this = this;\n\n    if (this._enabled) {\n      return;\n    }\n\n    var onKeyDown = Event.chain(domEvent(this.view.getHTMLElement(), 'keydown')).filter(function (e) {\n      return !isInputElement(e.target) || e.target === _this.filterOnTypeDomNode;\n    }).filter(function (e) {\n      return e.key !== 'Dead' && !/^Media/.test(e.key);\n    }).map(function (e) {\n      return new StandardKeyboardEvent(e);\n    }).filter(this.keyboardNavigationEventFilter || function () {\n      return true;\n    }).filter(function () {\n      return _this.automaticKeyboardNavigation || _this.triggered;\n    }).filter(function (e) {\n      return _this.keyboardNavigationDelegate.mightProducePrintableCharacter(e) || (_this.pattern.length > 0 || _this.triggered) && (e.keyCode === 9\n      /* Escape */\n      || e.keyCode === 1\n      /* Backspace */\n      ) && !e.altKey && !e.ctrlKey && !e.metaKey || e.keyCode === 1\n      /* Backspace */\n      && (isMacintosh ? e.altKey && !e.metaKey : e.ctrlKey) && !e.shiftKey;\n    }).forEach(function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n    }).event;\n    var onClear = domEvent(this.clearDomNode, 'click');\n    Event.chain(Event.any(onKeyDown, onClear)).event(this.onEventOrInput, this, this.enabledDisposables);\n    this.filter.pattern = '';\n    this.tree.refilter();\n    this.render();\n    this._enabled = true;\n    this.triggered = false;\n  };\n\n  TypeFilterController.prototype.disable = function () {\n    if (!this._enabled) {\n      return;\n    }\n\n    this.domNode.remove();\n    this.enabledDisposables.clear();\n    this.tree.refilter();\n    this.render();\n    this._enabled = false;\n    this.triggered = false;\n  };\n\n  TypeFilterController.prototype.onEventOrInput = function (e) {\n    if (typeof e === 'string') {\n      this.onInput(e);\n    } else if (e instanceof MouseEvent || e.keyCode === 9\n    /* Escape */\n    || e.keyCode === 1\n    /* Backspace */\n    && (isMacintosh ? e.altKey : e.ctrlKey)) {\n      this.onInput('');\n    } else if (e.keyCode === 1\n    /* Backspace */\n    ) {\n        this.onInput(this.pattern.length === 0 ? '' : this.pattern.substr(0, this.pattern.length - 1));\n      } else {\n      this.onInput(this.pattern + e.browserEvent.key);\n    }\n  };\n\n  TypeFilterController.prototype.onInput = function (pattern) {\n    var container = this.view.getHTMLElement();\n\n    if (pattern && !this.domNode.parentElement) {\n      container.append(this.domNode);\n    } else if (!pattern && this.domNode.parentElement) {\n      this.domNode.remove();\n      this.tree.domFocus();\n    }\n\n    this._pattern = pattern;\n\n    this._onDidChangePattern.fire(pattern);\n\n    this.filter.pattern = pattern;\n    this.tree.refilter();\n\n    if (pattern) {\n      this.tree.focusNext(0, true, undefined, function (node) {\n        return !FuzzyScore.isDefault(node.filterData);\n      });\n    }\n\n    var focus = this.tree.getFocus();\n\n    if (focus.length > 0) {\n      var element = focus[0];\n\n      if (this.tree.getRelativeTop(element) === null) {\n        this.tree.reveal(element, 0.5);\n      }\n    }\n\n    this.render();\n\n    if (!pattern) {\n      this.triggered = false;\n    }\n  };\n\n  TypeFilterController.prototype.onDragStart = function () {\n    var _this = this;\n\n    var container = this.view.getHTMLElement();\n    var left = getDomNodePagePosition(container).left;\n    var containerWidth = container.clientWidth;\n    var midContainerWidth = containerWidth / 2;\n    var width = this.domNode.clientWidth;\n    var disposables = new DisposableStore();\n    var positionClassName = this.positionClassName;\n\n    var updatePosition = function () {\n      switch (positionClassName) {\n        case 'nw':\n          _this.domNode.style.top = \"4px\";\n          _this.domNode.style.left = \"4px\";\n          break;\n\n        case 'ne':\n          _this.domNode.style.top = \"4px\";\n          _this.domNode.style.left = containerWidth - width - 6 + \"px\";\n          break;\n      }\n    };\n\n    var onDragOver = function (event) {\n      event.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n      var x = event.screenX - left;\n\n      if (event.dataTransfer) {\n        event.dataTransfer.dropEffect = 'none';\n      }\n\n      if (x < midContainerWidth) {\n        positionClassName = 'nw';\n      } else {\n        positionClassName = 'ne';\n      }\n\n      updatePosition();\n    };\n\n    var onDragEnd = function () {\n      _this.positionClassName = positionClassName;\n      _this.domNode.className = \"monaco-list-type-filter \" + _this.positionClassName;\n      _this.domNode.style.top = '';\n      _this.domNode.style.left = '';\n      dispose(disposables);\n    };\n\n    updatePosition();\n    removeClass(this.domNode, positionClassName);\n    addClass(this.domNode, 'dragging');\n    disposables.add(toDisposable(function () {\n      return removeClass(_this.domNode, 'dragging');\n    }));\n    domEvent(document, 'dragover')(onDragOver, null, disposables);\n    domEvent(this.domNode, 'dragend')(onDragEnd, null, disposables);\n    StaticDND.CurrentDragAndDropData = new DragAndDropData('vscode-ui');\n    disposables.add(toDisposable(function () {\n      return StaticDND.CurrentDragAndDropData = undefined;\n    }));\n  };\n\n  TypeFilterController.prototype.onDidSpliceModel = function () {\n    if (!this._enabled || this.pattern.length === 0) {\n      return;\n    }\n\n    this.tree.refilter();\n    this.render();\n  };\n\n  TypeFilterController.prototype.onDidChangeFilterOnType = function () {\n    this.tree.updateOptions({\n      filterOnType: this.filterOnTypeDomNode.checked\n    });\n    this.tree.refilter();\n    this.tree.domFocus();\n    this.render();\n    this.updateFilterOnTypeTitle();\n  };\n\n  TypeFilterController.prototype.updateFilterOnTypeTitle = function () {\n    if (this.filterOnType) {\n      this.filterOnTypeDomNode.title = localize('disable filter on type', \"Disable Filter on Type\");\n    } else {\n      this.filterOnTypeDomNode.title = localize('enable filter on type', \"Enable Filter on Type\");\n    }\n  };\n\n  TypeFilterController.prototype.render = function () {\n    var noMatches = this.filter.totalCount > 0 && this.filter.matchCount === 0;\n\n    if (this.pattern && this.tree.options.filterOnType && noMatches) {\n      this.messageDomNode.textContent = localize('empty', \"No elements found\");\n      this._empty = true;\n    } else {\n      this.messageDomNode.innerHTML = '';\n      this._empty = false;\n    }\n\n    toggleClass(this.domNode, 'no-matches', noMatches);\n    this.domNode.title = localize('found', \"Matched {0} out of {1} elements\", this.filter.matchCount, this.filter.totalCount);\n    this.labelDomNode.textContent = this.pattern.length > 16 ? 'â€¦' + this.pattern.substr(this.pattern.length - 16) : this.pattern;\n\n    this._onDidChangeEmptyState.fire(this._empty);\n  };\n\n  TypeFilterController.prototype.shouldAllowFocus = function (node) {\n    if (!this.enabled || !this.pattern || this.filterOnType) {\n      return true;\n    }\n\n    if (this.filter.totalCount > 0 && this.filter.matchCount <= 1) {\n      return true;\n    }\n\n    return !FuzzyScore.isDefault(node.filterData);\n  };\n\n  TypeFilterController.prototype.dispose = function () {\n    if (this._enabled) {\n      this.domNode.remove();\n      this.enabledDisposables.dispose();\n      this._enabled = false;\n      this.triggered = false;\n    }\n\n    this._onDidChangePattern.dispose();\n\n    dispose(this.disposables);\n  };\n\n  return TypeFilterController;\n}();\n\nfunction isInputElement(e) {\n  return e.tagName === 'INPUT' || e.tagName === 'TEXTAREA';\n}\n\nfunction asTreeEvent(event) {\n  return {\n    elements: event.elements.map(function (node) {\n      return node.element;\n    }),\n    browserEvent: event.browserEvent\n  };\n}\n\nfunction dfs(node, fn) {\n  fn(node);\n  node.children.forEach(function (child) {\n    return dfs(child, fn);\n  });\n}\n/**\r\n * The trait concept needs to exist at the tree level, because collapsed\r\n * tree nodes will not be known by the list.\r\n */\n\n\nvar Trait =\n/** @class */\nfunction () {\n  function Trait(identityProvider) {\n    this.identityProvider = identityProvider;\n    this.nodes = [];\n    this._onDidChange = new Emitter();\n    this.onDidChange = this._onDidChange.event;\n  }\n\n  Object.defineProperty(Trait.prototype, \"nodeSet\", {\n    get: function () {\n      if (!this._nodeSet) {\n        this._nodeSet = this.createNodeSet();\n      }\n\n      return this._nodeSet;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Trait.prototype.set = function (nodes, browserEvent) {\n    if (equals(this.nodes, nodes)) {\n      return;\n    }\n\n    this._set(nodes, false, browserEvent);\n  };\n\n  Trait.prototype._set = function (nodes, silent, browserEvent) {\n    this.nodes = __spreadArrays(nodes);\n    this.elements = undefined;\n    this._nodeSet = undefined;\n\n    if (!silent) {\n      var that_1 = this;\n\n      this._onDidChange.fire({\n        get elements() {\n          return that_1.get();\n        },\n\n        browserEvent: browserEvent\n      });\n    }\n  };\n\n  Trait.prototype.get = function () {\n    if (!this.elements) {\n      this.elements = this.nodes.map(function (node) {\n        return node.element;\n      });\n    }\n\n    return __spreadArrays(this.elements);\n  };\n\n  Trait.prototype.getNodes = function () {\n    return this.nodes;\n  };\n\n  Trait.prototype.has = function (node) {\n    return this.nodeSet.has(node);\n  };\n\n  Trait.prototype.onDidModelSplice = function (_a) {\n    var _this = this;\n\n    var insertedNodes = _a.insertedNodes,\n        deletedNodes = _a.deletedNodes;\n\n    if (!this.identityProvider) {\n      var set_1 = this.createNodeSet();\n\n      var visit_1 = function (node) {\n        return set_1.delete(node);\n      };\n\n      deletedNodes.forEach(function (node) {\n        return dfs(node, visit_1);\n      });\n      this.set(values(set_1));\n      return;\n    }\n\n    var deletedNodesIdSet = new Set();\n\n    var deletedNodesVisitor = function (node) {\n      return deletedNodesIdSet.add(_this.identityProvider.getId(node.element).toString());\n    };\n\n    deletedNodes.forEach(function (node) {\n      return dfs(node, deletedNodesVisitor);\n    });\n    var insertedNodesMap = new Map();\n\n    var insertedNodesVisitor = function (node) {\n      return insertedNodesMap.set(_this.identityProvider.getId(node.element).toString(), node);\n    };\n\n    insertedNodes.forEach(function (node) {\n      return dfs(node, insertedNodesVisitor);\n    });\n    var nodes = [];\n\n    for (var _i = 0, _b = this.nodes; _i < _b.length; _i++) {\n      var node = _b[_i];\n      var id = this.identityProvider.getId(node.element).toString();\n      var wasDeleted = deletedNodesIdSet.has(id);\n\n      if (!wasDeleted) {\n        nodes.push(node);\n      } else {\n        var insertedNode = insertedNodesMap.get(id);\n\n        if (insertedNode) {\n          nodes.push(insertedNode);\n        }\n      }\n    }\n\n    this._set(nodes, true);\n  };\n\n  Trait.prototype.createNodeSet = function () {\n    var set = new Set();\n\n    for (var _i = 0, _a = this.nodes; _i < _a.length; _i++) {\n      var node = _a[_i];\n      set.add(node);\n    }\n\n    return set;\n  };\n\n  return Trait;\n}();\n\nvar TreeNodeListMouseController =\n/** @class */\nfunction (_super) {\n  __extends(TreeNodeListMouseController, _super);\n\n  function TreeNodeListMouseController(list, tree) {\n    var _this = _super.call(this, list) || this;\n\n    _this.tree = tree;\n    return _this;\n  }\n\n  TreeNodeListMouseController.prototype.onPointer = function (e) {\n    if (isInputElement(e.browserEvent.target)) {\n      return;\n    }\n\n    var node = e.element;\n\n    if (!node) {\n      return _super.prototype.onPointer.call(this, e);\n    }\n\n    if (this.isSelectionRangeChangeEvent(e) || this.isSelectionSingleChangeEvent(e)) {\n      return _super.prototype.onPointer.call(this, e);\n    }\n\n    var onTwistie = hasClass(e.browserEvent.target, 'monaco-tl-twistie');\n\n    if (!this.tree.openOnSingleClick && e.browserEvent.detail !== 2 && !onTwistie) {\n      return _super.prototype.onPointer.call(this, e);\n    }\n\n    var expandOnlyOnTwistieClick = false;\n\n    if (typeof this.tree.expandOnlyOnTwistieClick === 'function') {\n      expandOnlyOnTwistieClick = this.tree.expandOnlyOnTwistieClick(node.element);\n    } else {\n      expandOnlyOnTwistieClick = !!this.tree.expandOnlyOnTwistieClick;\n    }\n\n    if (expandOnlyOnTwistieClick && !onTwistie) {\n      return _super.prototype.onPointer.call(this, e);\n    }\n\n    if (node.collapsible) {\n      var model = this.tree.model; // internal\n\n      var location_1 = model.getNodeLocation(node);\n      var recursive = e.browserEvent.altKey;\n      model.setCollapsed(location_1, undefined, recursive);\n\n      if (expandOnlyOnTwistieClick && onTwistie) {\n        return;\n      }\n    }\n\n    _super.prototype.onPointer.call(this, e);\n  };\n\n  TreeNodeListMouseController.prototype.onDoubleClick = function (e) {\n    var onTwistie = hasClass(e.browserEvent.target, 'monaco-tl-twistie');\n\n    if (onTwistie) {\n      return;\n    }\n\n    _super.prototype.onDoubleClick.call(this, e);\n  };\n\n  return TreeNodeListMouseController;\n}(MouseController);\n/**\r\n * We use this List subclass to restore selection and focus as nodes\r\n * get rendered in the list, possibly due to a node expand() call.\r\n */\n\n\nvar TreeNodeList =\n/** @class */\nfunction (_super) {\n  __extends(TreeNodeList, _super);\n\n  function TreeNodeList(user, container, virtualDelegate, renderers, focusTrait, selectionTrait, options) {\n    var _this = _super.call(this, user, container, virtualDelegate, renderers, options) || this;\n\n    _this.focusTrait = focusTrait;\n    _this.selectionTrait = selectionTrait;\n    return _this;\n  }\n\n  TreeNodeList.prototype.createMouseController = function (options) {\n    return new TreeNodeListMouseController(this, options.tree);\n  };\n\n  TreeNodeList.prototype.splice = function (start, deleteCount, elements) {\n    var _this = this;\n\n    if (elements === void 0) {\n      elements = [];\n    }\n\n    _super.prototype.splice.call(this, start, deleteCount, elements);\n\n    if (elements.length === 0) {\n      return;\n    }\n\n    var additionalFocus = [];\n    var additionalSelection = [];\n    elements.forEach(function (node, index) {\n      if (_this.focusTrait.has(node)) {\n        additionalFocus.push(start + index);\n      }\n\n      if (_this.selectionTrait.has(node)) {\n        additionalSelection.push(start + index);\n      }\n    });\n\n    if (additionalFocus.length > 0) {\n      _super.prototype.setFocus.call(this, distinctES6(__spreadArrays(_super.prototype.getFocus.call(this), additionalFocus)));\n    }\n\n    if (additionalSelection.length > 0) {\n      _super.prototype.setSelection.call(this, distinctES6(__spreadArrays(_super.prototype.getSelection.call(this), additionalSelection)));\n    }\n  };\n\n  TreeNodeList.prototype.setFocus = function (indexes, browserEvent, fromAPI) {\n    var _this = this;\n\n    if (fromAPI === void 0) {\n      fromAPI = false;\n    }\n\n    _super.prototype.setFocus.call(this, indexes, browserEvent);\n\n    if (!fromAPI) {\n      this.focusTrait.set(indexes.map(function (i) {\n        return _this.element(i);\n      }), browserEvent);\n    }\n  };\n\n  TreeNodeList.prototype.setSelection = function (indexes, browserEvent, fromAPI) {\n    var _this = this;\n\n    if (fromAPI === void 0) {\n      fromAPI = false;\n    }\n\n    _super.prototype.setSelection.call(this, indexes, browserEvent);\n\n    if (!fromAPI) {\n      this.selectionTrait.set(indexes.map(function (i) {\n        return _this.element(i);\n      }), browserEvent);\n    }\n  };\n\n  return TreeNodeList;\n}(List);\n\nvar AbstractTree =\n/** @class */\nfunction () {\n  function AbstractTree(user, container, delegate, renderers, _options) {\n    var _this = this;\n\n    if (_options === void 0) {\n      _options = {};\n    }\n\n    this._options = _options;\n    this.eventBufferer = new EventBufferer();\n    this.disposables = new DisposableStore();\n    this._onWillRefilter = new Emitter();\n    this.onWillRefilter = this._onWillRefilter.event;\n    this._onDidUpdateOptions = new Emitter();\n    var treeDelegate = new ComposedTreeDelegate(delegate);\n    var onDidChangeCollapseStateRelay = new Relay();\n    var onDidChangeActiveNodes = new Relay();\n    var activeNodes = new EventCollection(onDidChangeActiveNodes.event);\n    this.renderers = renderers.map(function (r) {\n      return new TreeRenderer(r, function () {\n        return _this.model;\n      }, onDidChangeCollapseStateRelay.event, activeNodes, _options);\n    });\n\n    for (var _i = 0, _a = this.renderers; _i < _a.length; _i++) {\n      var r = _a[_i];\n      this.disposables.add(r);\n    }\n\n    var filter;\n\n    if (_options.keyboardNavigationLabelProvider) {\n      filter = new TypeFilter(this, _options.keyboardNavigationLabelProvider, _options.filter);\n      _options = __assign(__assign({}, _options), {\n        filter: filter\n      }); // TODO need typescript help here\n\n      this.disposables.add(filter);\n    }\n\n    this.focus = new Trait(_options.identityProvider);\n    this.selection = new Trait(_options.identityProvider);\n    this.view = new TreeNodeList(user, container, treeDelegate, this.renderers, this.focus, this.selection, __assign(__assign({}, asListOptions(function () {\n      return _this.model;\n    }, _options)), {\n      tree: this\n    }));\n    this.model = this.createModel(user, this.view, _options);\n    onDidChangeCollapseStateRelay.input = this.model.onDidChangeCollapseState;\n    var onDidModelSplice = Event.forEach(this.model.onDidSplice, function (e) {\n      _this.eventBufferer.bufferEvents(function () {\n        _this.focus.onDidModelSplice(e);\n\n        _this.selection.onDidModelSplice(e);\n      });\n    }); // Make sure the `forEach` always runs\n\n    onDidModelSplice(function () {\n      return null;\n    }, null, this.disposables); // Active nodes can change when the model changes or when focus or selection change.\n    // We debounce it with 0 delay since these events may fire in the same stack and we only\n    // want to run this once. It also doesn't matter if it runs on the next tick since it's only\n    // a nice to have UI feature.\n\n    onDidChangeActiveNodes.input = Event.chain(Event.any(onDidModelSplice, this.focus.onDidChange, this.selection.onDidChange)).debounce(function () {\n      return null;\n    }, 0).map(function () {\n      var set = new Set();\n\n      for (var _i = 0, _a = _this.focus.getNodes(); _i < _a.length; _i++) {\n        var node = _a[_i];\n        set.add(node);\n      }\n\n      for (var _b = 0, _c = _this.selection.getNodes(); _b < _c.length; _b++) {\n        var node = _c[_b];\n        set.add(node);\n      }\n\n      return fromSet(set);\n    }).event;\n\n    if (_options.keyboardSupport !== false) {\n      var onKeyDown = Event.chain(this.view.onKeyDown).filter(function (e) {\n        return !isInputElement(e.target);\n      }).map(function (e) {\n        return new StandardKeyboardEvent(e);\n      });\n      onKeyDown.filter(function (e) {\n        return e.keyCode === 15\n        /* LeftArrow */\n        ;\n      }).on(this.onLeftArrow, this, this.disposables);\n      onKeyDown.filter(function (e) {\n        return e.keyCode === 17\n        /* RightArrow */\n        ;\n      }).on(this.onRightArrow, this, this.disposables);\n      onKeyDown.filter(function (e) {\n        return e.keyCode === 10\n        /* Space */\n        ;\n      }).on(this.onSpace, this, this.disposables);\n    }\n\n    if (_options.keyboardNavigationLabelProvider) {\n      var delegate_1 = _options.keyboardNavigationDelegate || DefaultKeyboardNavigationDelegate;\n      this.typeFilterController = new TypeFilterController(this, this.model, this.view, filter, delegate_1);\n\n      this.focusNavigationFilter = function (node) {\n        return _this.typeFilterController.shouldAllowFocus(node);\n      };\n\n      this.disposables.add(this.typeFilterController);\n    }\n\n    this.styleElement = createStyleSheet(this.view.getHTMLElement());\n    toggleClass(this.getHTMLElement(), 'always', this._options.renderIndentGuides === RenderIndentGuides.Always);\n  }\n\n  Object.defineProperty(AbstractTree.prototype, \"onDidChangeFocus\", {\n    get: function () {\n      return this.eventBufferer.wrapEvent(this.focus.onDidChange);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AbstractTree.prototype, \"onDidChangeSelection\", {\n    get: function () {\n      return this.eventBufferer.wrapEvent(this.selection.onDidChange);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AbstractTree.prototype, \"onDidOpen\", {\n    get: function () {\n      return Event.map(this.view.onDidOpen, asTreeEvent);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AbstractTree.prototype, \"onDidFocus\", {\n    get: function () {\n      return this.view.onDidFocus;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AbstractTree.prototype, \"onDidChangeCollapseState\", {\n    get: function () {\n      return this.model.onDidChangeCollapseState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AbstractTree.prototype, \"openOnSingleClick\", {\n    get: function () {\n      return typeof this._options.openOnSingleClick === 'undefined' ? true : this._options.openOnSingleClick;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AbstractTree.prototype, \"expandOnlyOnTwistieClick\", {\n    get: function () {\n      return typeof this._options.expandOnlyOnTwistieClick === 'undefined' ? false : this._options.expandOnlyOnTwistieClick;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AbstractTree.prototype, \"onDidDispose\", {\n    get: function () {\n      return this.view.onDidDispose;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AbstractTree.prototype.updateOptions = function (optionsUpdate) {\n    if (optionsUpdate === void 0) {\n      optionsUpdate = {};\n    }\n\n    this._options = __assign(__assign({}, this._options), optionsUpdate);\n\n    for (var _i = 0, _a = this.renderers; _i < _a.length; _i++) {\n      var renderer = _a[_i];\n      renderer.updateOptions(optionsUpdate);\n    }\n\n    this.view.updateOptions({\n      enableKeyboardNavigation: this._options.simpleKeyboardNavigation,\n      automaticKeyboardNavigation: this._options.automaticKeyboardNavigation\n    });\n\n    if (this.typeFilterController) {\n      this.typeFilterController.updateOptions(this._options);\n    }\n\n    this._onDidUpdateOptions.fire(this._options);\n\n    toggleClass(this.getHTMLElement(), 'always', this._options.renderIndentGuides === RenderIndentGuides.Always);\n  };\n\n  Object.defineProperty(AbstractTree.prototype, \"options\", {\n    get: function () {\n      return this._options;\n    },\n    enumerable: true,\n    configurable: true\n  }); // Widget\n\n  AbstractTree.prototype.getHTMLElement = function () {\n    return this.view.getHTMLElement();\n  };\n\n  Object.defineProperty(AbstractTree.prototype, \"scrollTop\", {\n    get: function () {\n      return this.view.scrollTop;\n    },\n    set: function (scrollTop) {\n      this.view.scrollTop = scrollTop;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AbstractTree.prototype.domFocus = function () {\n    this.view.domFocus();\n  };\n\n  AbstractTree.prototype.layout = function (height, width) {\n    this.view.layout(height, width);\n  };\n\n  AbstractTree.prototype.style = function (styles) {\n    var suffix = \".\" + this.view.domId;\n    var content = [];\n\n    if (styles.treeIndentGuidesStroke) {\n      content.push(\".monaco-list\" + suffix + \":hover .monaco-tl-indent > .indent-guide, .monaco-list\" + suffix + \".always .monaco-tl-indent > .indent-guide  { border-color: \" + styles.treeIndentGuidesStroke.transparent(0.4) + \"; }\");\n      content.push(\".monaco-list\" + suffix + \" .monaco-tl-indent > .indent-guide.active { border-color: \" + styles.treeIndentGuidesStroke + \"; }\");\n    }\n\n    var newStyles = content.join('\\n');\n\n    if (newStyles !== this.styleElement.innerHTML) {\n      this.styleElement.innerHTML = newStyles;\n    }\n\n    this.view.style(styles);\n  };\n\n  AbstractTree.prototype.collapse = function (location, recursive) {\n    if (recursive === void 0) {\n      recursive = false;\n    }\n\n    return this.model.setCollapsed(location, true, recursive);\n  };\n\n  AbstractTree.prototype.expand = function (location, recursive) {\n    if (recursive === void 0) {\n      recursive = false;\n    }\n\n    return this.model.setCollapsed(location, false, recursive);\n  };\n\n  AbstractTree.prototype.isCollapsible = function (location) {\n    return this.model.isCollapsible(location);\n  };\n\n  AbstractTree.prototype.setCollapsible = function (location, collapsible) {\n    return this.model.setCollapsible(location, collapsible);\n  };\n\n  AbstractTree.prototype.isCollapsed = function (location) {\n    return this.model.isCollapsed(location);\n  };\n\n  AbstractTree.prototype.refilter = function () {\n    this._onWillRefilter.fire(undefined);\n\n    this.model.refilter();\n  };\n\n  AbstractTree.prototype.setSelection = function (elements, browserEvent) {\n    var _this = this;\n\n    var nodes = elements.map(function (e) {\n      return _this.model.getNode(e);\n    });\n    this.selection.set(nodes, browserEvent);\n    var indexes = elements.map(function (e) {\n      return _this.model.getListIndex(e);\n    }).filter(function (i) {\n      return i > -1;\n    });\n    this.view.setSelection(indexes, browserEvent, true);\n  };\n\n  AbstractTree.prototype.getSelection = function () {\n    return this.selection.get();\n  };\n\n  AbstractTree.prototype.setFocus = function (elements, browserEvent) {\n    var _this = this;\n\n    var nodes = elements.map(function (e) {\n      return _this.model.getNode(e);\n    });\n    this.focus.set(nodes, browserEvent);\n    var indexes = elements.map(function (e) {\n      return _this.model.getListIndex(e);\n    }).filter(function (i) {\n      return i > -1;\n    });\n    this.view.setFocus(indexes, browserEvent, true);\n  };\n\n  AbstractTree.prototype.focusNext = function (n, loop, browserEvent, filter) {\n    if (n === void 0) {\n      n = 1;\n    }\n\n    if (loop === void 0) {\n      loop = false;\n    }\n\n    if (filter === void 0) {\n      filter = this.focusNavigationFilter;\n    }\n\n    this.view.focusNext(n, loop, browserEvent, filter);\n  };\n\n  AbstractTree.prototype.getFocus = function () {\n    return this.focus.get();\n  };\n\n  AbstractTree.prototype.reveal = function (location, relativeTop) {\n    this.model.expandTo(location);\n    var index = this.model.getListIndex(location);\n\n    if (index === -1) {\n      return;\n    }\n\n    this.view.reveal(index, relativeTop);\n  };\n  /**\r\n   * Returns the relative position of an element rendered in the list.\r\n   * Returns `null` if the element isn't *entirely* in the visible viewport.\r\n   */\n\n\n  AbstractTree.prototype.getRelativeTop = function (location) {\n    var index = this.model.getListIndex(location);\n\n    if (index === -1) {\n      return null;\n    }\n\n    return this.view.getRelativeTop(index);\n  }; // List\n\n\n  AbstractTree.prototype.onLeftArrow = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    var nodes = this.view.getFocusedElements();\n\n    if (nodes.length === 0) {\n      return;\n    }\n\n    var node = nodes[0];\n    var location = this.model.getNodeLocation(node);\n    var didChange = this.model.setCollapsed(location, true);\n\n    if (!didChange) {\n      var parentLocation = this.model.getParentNodeLocation(location);\n\n      if (!parentLocation) {\n        return;\n      }\n\n      var parentListIndex = this.model.getListIndex(parentLocation);\n      this.view.reveal(parentListIndex);\n      this.view.setFocus([parentListIndex]);\n    }\n  };\n\n  AbstractTree.prototype.onRightArrow = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    var nodes = this.view.getFocusedElements();\n\n    if (nodes.length === 0) {\n      return;\n    }\n\n    var node = nodes[0];\n    var location = this.model.getNodeLocation(node);\n    var didChange = this.model.setCollapsed(location, false);\n\n    if (!didChange) {\n      if (!node.children.some(function (child) {\n        return child.visible;\n      })) {\n        return;\n      }\n\n      var focusedIndex = this.view.getFocus()[0];\n      var firstChildIndex = focusedIndex + 1;\n      this.view.reveal(firstChildIndex);\n      this.view.setFocus([firstChildIndex]);\n    }\n  };\n\n  AbstractTree.prototype.onSpace = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    var nodes = this.view.getFocusedElements();\n\n    if (nodes.length === 0) {\n      return;\n    }\n\n    var node = nodes[0];\n    var location = this.model.getNodeLocation(node);\n    var recursive = e.browserEvent.altKey;\n    this.model.setCollapsed(location, undefined, recursive);\n  };\n\n  AbstractTree.prototype.dispose = function () {\n    dispose(this.disposables);\n    this.view.dispose();\n  };\n\n  return AbstractTree;\n}();\n\nexport { AbstractTree };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/ui/tree/abstractTree.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__spreadArrays","il","r","k","a","j","jl","dispose","Disposable","toDisposable","DisposableStore","List","MouseController","DefaultKeyboardNavigationDelegate","append","$","toggleClass","getDomNodePagePosition","removeClass","addClass","hasClass","createStyleSheet","clearNode","addClasses","removeClasses","Event","Relay","Emitter","EventBufferer","StandardKeyboardEvent","StaticDND","DragAndDropData","range","equals","distinctES6","fromSet","ElementsDragAndDropData","domEvent","fuzzyScore","FuzzyScore","getVisibleState","isFilterResult","localize","disposableTimeout","isMacintosh","values","clamp","SetMap","TreeElementsDragAndDropData","_super","data","_this","elements","map","node","element","asTreeDragAndDropData","TreeNodeListDragAndDrop","modelProvider","dnd","autoExpandDisposable","None","getDragURI","getDragLabel","nodes","originalEvent","undefined","onDragStart","onDragOver","targetNode","targetIndex","raw","result","didChangeAutoExpandNode","autoExpandNode","autoExpand","model","ref","getNodeLocation","isCollapsed","setCollapsed","accept","bubble","feedback","effect","model_1","ref_1","parentRef","getParentNodeLocation","parentNode","getNode","parentIndex","getListIndex","start","getListRenderCount","drop","onDragEnd","asListOptions","options","identityProvider","getId","el","multipleSelectionController","isSelectionSingleChangeEvent","e","isSelectionRangeChangeEvent","accessibilityProvider","getAriaLabel","getAriaLevel","depth","getActiveDescendantId","keyboardNavigationLabelProvider","getKeyboardNavigationLabel","enableKeyboardNavigation","simpleKeyboardNavigation","ariaProvider","getSetSize","visibleChildrenCount","getPosInSet","visibleChildIndex","isChecked","getRole","ComposedTreeDelegate","delegate","getHeight","getTemplateId","hasDynamicHeight","setDynamicHeight","height","RenderIndentGuides","EventCollection","onDidChange","_elements","forEach","defineProperty","get","enumerable","configurable","TreeRenderer","renderer","onDidChangeCollapseState","activeNodes","renderedElements","Map","renderedNodes","indent","DefaultIndent","hideTwistiesOfChildlessElements","shouldRenderIndentGuides","renderedIndentGuides","activeIndentNodes","Set","indentGuidesDisposable","disposables","templateId","updateOptions","onDidChangeNodeTwistieState","onDidChangeTwistieState","renderIndentGuides","_onDidChangeActiveNodes","renderTemplate","container","twistie","contents","templateData","renderElement","index","set","style","paddingLeft","width","renderTwistie","disposeElement","delete","disposeTemplate","collapsible","collapsed","setAttribute","String","removeAttribute","target","disposableStore","_loop_1","parent_1","guide","this_1","has","childElementCount","appendChild","insertBefore","firstElementChild","add","state_1","children","_a","line","clear","TypeFilter","tree","_filter","_totalCount","_matchCount","_pattern","_lowercasePattern","onWillRefilter","reset","pattern","toLowerCase","filter","parentVisibility","visibility","Default","label","labelStr","toString","score","filterOnType","TypeFilterController","view","keyboardNavigationDelegate","_enabled","_empty","_onDidChangeEmptyState","positionClassName","automaticKeyboardNavigation","triggered","_onDidChangePattern","enabledDisposables","domNode","draggable","messageDomNode","getHTMLElement","labelDomNode","controls","_filterOnType","filterOnTypeDomNode","type","checked","tabIndex","updateFilterOnTypeTitle","onDidChangeFilterOnType","clearDomNode","title","keyboardNavigationEventFilter","onDidSplice","onDidSpliceModel","disable","enable","refilter","render","onEventOrInput","onKeyDown","chain","isInputElement","key","test","mightProducePrintableCharacter","keyCode","altKey","ctrlKey","metaKey","shiftKey","stopPropagation","preventDefault","event","onClear","any","remove","onInput","MouseEvent","substr","browserEvent","parentElement","domFocus","fire","focusNext","isDefault","filterData","focus","getFocus","getRelativeTop","reveal","left","containerWidth","clientWidth","midContainerWidth","updatePosition","top","x","screenX","dataTransfer","dropEffect","className","document","CurrentDragAndDropData","noMatches","totalCount","matchCount","textContent","innerHTML","shouldAllowFocus","enabled","tagName","asTreeEvent","dfs","fn","child","Trait","_onDidChange","_nodeSet","createNodeSet","_set","silent","that_1","getNodes","nodeSet","onDidModelSplice","insertedNodes","deletedNodes","set_1","visit_1","deletedNodesIdSet","deletedNodesVisitor","insertedNodesMap","insertedNodesVisitor","_i","_b","id","wasDeleted","push","insertedNode","TreeNodeListMouseController","list","onPointer","onTwistie","openOnSingleClick","detail","expandOnlyOnTwistieClick","location_1","recursive","onDoubleClick","TreeNodeList","user","virtualDelegate","renderers","focusTrait","selectionTrait","createMouseController","splice","deleteCount","additionalFocus","additionalSelection","setFocus","setSelection","getSelection","indexes","fromAPI","AbstractTree","_options","eventBufferer","_onWillRefilter","_onDidUpdateOptions","treeDelegate","onDidChangeCollapseStateRelay","onDidChangeActiveNodes","selection","createModel","input","bufferEvents","debounce","_c","keyboardSupport","on","onLeftArrow","onRightArrow","onSpace","delegate_1","typeFilterController","focusNavigationFilter","styleElement","Always","wrapEvent","onDidOpen","onDidFocus","onDidDispose","optionsUpdate","scrollTop","layout","styles","suffix","domId","content","treeIndentGuidesStroke","transparent","newStyles","join","collapse","location","expand","isCollapsible","setCollapsible","loop","relativeTop","expandTo","getFocusedElements","didChange","parentLocation","parentListIndex","some","visible","focusedIndex","firstChildIndex"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport './media/tree.css';\r\nimport { dispose, Disposable, toDisposable, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { List, MouseController, DefaultKeyboardNavigationDelegate } from '../list/listWidget.js';\r\nimport { append, $, toggleClass, getDomNodePagePosition, removeClass, addClass, hasClass, createStyleSheet, clearNode, addClasses, removeClasses } from '../../dom.js';\r\nimport { Event, Relay, Emitter, EventBufferer } from '../../../common/event.js';\r\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\r\nimport { StaticDND, DragAndDropData } from '../../dnd.js';\r\nimport { range, equals, distinctES6, fromSet } from '../../../common/arrays.js';\r\nimport { ElementsDragAndDropData } from '../list/listView.js';\r\nimport { domEvent } from '../../event.js';\r\nimport { fuzzyScore, FuzzyScore } from '../../../common/filters.js';\r\nimport { getVisibleState, isFilterResult } from './indexTreeModel.js';\r\nimport { localize } from '../../../../nls.js';\r\nimport { disposableTimeout } from '../../../common/async.js';\r\nimport { isMacintosh } from '../../../common/platform.js';\r\nimport { values } from '../../../common/map.js';\r\nimport { clamp } from '../../../common/numbers.js';\r\nimport { SetMap } from '../../../common/collections.js';\r\nvar TreeElementsDragAndDropData = /** @class */ (function (_super) {\r\n    __extends(TreeElementsDragAndDropData, _super);\r\n    function TreeElementsDragAndDropData(data) {\r\n        var _this = _super.call(this, data.elements.map(function (node) { return node.element; })) || this;\r\n        _this.data = data;\r\n        return _this;\r\n    }\r\n    return TreeElementsDragAndDropData;\r\n}(ElementsDragAndDropData));\r\nfunction asTreeDragAndDropData(data) {\r\n    if (data instanceof ElementsDragAndDropData) {\r\n        return new TreeElementsDragAndDropData(data);\r\n    }\r\n    return data;\r\n}\r\nvar TreeNodeListDragAndDrop = /** @class */ (function () {\r\n    function TreeNodeListDragAndDrop(modelProvider, dnd) {\r\n        this.modelProvider = modelProvider;\r\n        this.dnd = dnd;\r\n        this.autoExpandDisposable = Disposable.None;\r\n    }\r\n    TreeNodeListDragAndDrop.prototype.getDragURI = function (node) {\r\n        return this.dnd.getDragURI(node.element);\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.getDragLabel = function (nodes, originalEvent) {\r\n        if (this.dnd.getDragLabel) {\r\n            return this.dnd.getDragLabel(nodes.map(function (node) { return node.element; }), originalEvent);\r\n        }\r\n        return undefined;\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.onDragStart = function (data, originalEvent) {\r\n        if (this.dnd.onDragStart) {\r\n            this.dnd.onDragStart(asTreeDragAndDropData(data), originalEvent);\r\n        }\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.onDragOver = function (data, targetNode, targetIndex, originalEvent, raw) {\r\n        var _this = this;\r\n        if (raw === void 0) { raw = true; }\r\n        var result = this.dnd.onDragOver(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n        var didChangeAutoExpandNode = this.autoExpandNode !== targetNode;\r\n        if (didChangeAutoExpandNode) {\r\n            this.autoExpandDisposable.dispose();\r\n            this.autoExpandNode = targetNode;\r\n        }\r\n        if (typeof targetNode === 'undefined') {\r\n            return result;\r\n        }\r\n        if (didChangeAutoExpandNode && typeof result !== 'boolean' && result.autoExpand) {\r\n            this.autoExpandDisposable = disposableTimeout(function () {\r\n                var model = _this.modelProvider();\r\n                var ref = model.getNodeLocation(targetNode);\r\n                if (model.isCollapsed(ref)) {\r\n                    model.setCollapsed(ref, false);\r\n                }\r\n                _this.autoExpandNode = undefined;\r\n            }, 500);\r\n        }\r\n        if (typeof result === 'boolean' || !result.accept || typeof result.bubble === 'undefined' || result.feedback) {\r\n            if (!raw) {\r\n                var accept = typeof result === 'boolean' ? result : result.accept;\r\n                var effect = typeof result === 'boolean' ? undefined : result.effect;\r\n                return { accept: accept, effect: effect, feedback: [targetIndex] };\r\n            }\r\n            return result;\r\n        }\r\n        if (result.bubble === 1 /* Up */) {\r\n            var model_1 = this.modelProvider();\r\n            var ref_1 = model_1.getNodeLocation(targetNode);\r\n            var parentRef = model_1.getParentNodeLocation(ref_1);\r\n            var parentNode = model_1.getNode(parentRef);\r\n            var parentIndex = parentRef && model_1.getListIndex(parentRef);\r\n            return this.onDragOver(data, parentNode, parentIndex, originalEvent, false);\r\n        }\r\n        var model = this.modelProvider();\r\n        var ref = model.getNodeLocation(targetNode);\r\n        var start = model.getListIndex(ref);\r\n        var length = model.getListRenderCount(ref);\r\n        return __assign(__assign({}, result), { feedback: range(start, start + length) });\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.drop = function (data, targetNode, targetIndex, originalEvent) {\r\n        this.autoExpandDisposable.dispose();\r\n        this.autoExpandNode = undefined;\r\n        this.dnd.drop(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.onDragEnd = function (originalEvent) {\r\n        if (this.dnd.onDragEnd) {\r\n            this.dnd.onDragEnd(originalEvent);\r\n        }\r\n    };\r\n    return TreeNodeListDragAndDrop;\r\n}());\r\nfunction asListOptions(modelProvider, options) {\r\n    return options && __assign(__assign({}, options), { identityProvider: options.identityProvider && {\r\n            getId: function (el) {\r\n                return options.identityProvider.getId(el.element);\r\n            }\r\n        }, dnd: options.dnd && new TreeNodeListDragAndDrop(modelProvider, options.dnd), multipleSelectionController: options.multipleSelectionController && {\r\n            isSelectionSingleChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionSingleChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            },\r\n            isSelectionRangeChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionRangeChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            }\r\n        }, accessibilityProvider: options.accessibilityProvider && __assign(__assign({}, options.accessibilityProvider), { getAriaLabel: function (e) {\r\n                return options.accessibilityProvider.getAriaLabel(e.element);\r\n            },\r\n            getAriaLevel: function (node) {\r\n                return node.depth;\r\n            }, getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && (function (node) {\r\n                return options.accessibilityProvider.getActiveDescendantId(node.element);\r\n            }) }), keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && __assign(__assign({}, options.keyboardNavigationLabelProvider), { getKeyboardNavigationLabel: function (node) {\r\n                return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(node.element);\r\n            } }), enableKeyboardNavigation: options.simpleKeyboardNavigation, ariaProvider: {\r\n            getSetSize: function (node) {\r\n                var model = modelProvider();\r\n                var ref = model.getNodeLocation(node);\r\n                var parentRef = model.getParentNodeLocation(ref);\r\n                var parentNode = model.getNode(parentRef);\r\n                return parentNode.visibleChildrenCount;\r\n            },\r\n            getPosInSet: function (node) {\r\n                return node.visibleChildIndex + 1;\r\n            },\r\n            isChecked: options.ariaProvider && options.ariaProvider.isChecked ? function (node) {\r\n                return options.ariaProvider.isChecked(node.element);\r\n            } : undefined,\r\n            getRole: options.ariaProvider && options.ariaProvider.getRole ? function (node) {\r\n                return options.ariaProvider.getRole(node.element);\r\n            } : undefined\r\n        } });\r\n}\r\nvar ComposedTreeDelegate = /** @class */ (function () {\r\n    function ComposedTreeDelegate(delegate) {\r\n        this.delegate = delegate;\r\n    }\r\n    ComposedTreeDelegate.prototype.getHeight = function (element) {\r\n        return this.delegate.getHeight(element.element);\r\n    };\r\n    ComposedTreeDelegate.prototype.getTemplateId = function (element) {\r\n        return this.delegate.getTemplateId(element.element);\r\n    };\r\n    ComposedTreeDelegate.prototype.hasDynamicHeight = function (element) {\r\n        return !!this.delegate.hasDynamicHeight && this.delegate.hasDynamicHeight(element.element);\r\n    };\r\n    ComposedTreeDelegate.prototype.setDynamicHeight = function (element, height) {\r\n        if (this.delegate.setDynamicHeight) {\r\n            this.delegate.setDynamicHeight(element.element, height);\r\n        }\r\n    };\r\n    return ComposedTreeDelegate;\r\n}());\r\nexport { ComposedTreeDelegate };\r\nexport var RenderIndentGuides;\r\n(function (RenderIndentGuides) {\r\n    RenderIndentGuides[\"None\"] = \"none\";\r\n    RenderIndentGuides[\"OnHover\"] = \"onHover\";\r\n    RenderIndentGuides[\"Always\"] = \"always\";\r\n})(RenderIndentGuides || (RenderIndentGuides = {}));\r\nvar EventCollection = /** @class */ (function () {\r\n    function EventCollection(onDidChange, _elements) {\r\n        var _this = this;\r\n        if (_elements === void 0) { _elements = []; }\r\n        this._elements = _elements;\r\n        this.onDidChange = Event.forEach(onDidChange, function (elements) { return _this._elements = elements; });\r\n    }\r\n    Object.defineProperty(EventCollection.prototype, \"elements\", {\r\n        get: function () {\r\n            return this._elements;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return EventCollection;\r\n}());\r\nvar TreeRenderer = /** @class */ (function () {\r\n    function TreeRenderer(renderer, modelProvider, onDidChangeCollapseState, activeNodes, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.renderer = renderer;\r\n        this.modelProvider = modelProvider;\r\n        this.activeNodes = activeNodes;\r\n        this.renderedElements = new Map();\r\n        this.renderedNodes = new Map();\r\n        this.indent = TreeRenderer.DefaultIndent;\r\n        this.hideTwistiesOfChildlessElements = false;\r\n        this.shouldRenderIndentGuides = false;\r\n        this.renderedIndentGuides = new SetMap();\r\n        this.activeIndentNodes = new Set();\r\n        this.indentGuidesDisposable = Disposable.None;\r\n        this.disposables = new DisposableStore();\r\n        this.templateId = renderer.templateId;\r\n        this.updateOptions(options);\r\n        Event.map(onDidChangeCollapseState, function (e) { return e.node; })(this.onDidChangeNodeTwistieState, this, this.disposables);\r\n        if (renderer.onDidChangeTwistieState) {\r\n            renderer.onDidChangeTwistieState(this.onDidChangeTwistieState, this, this.disposables);\r\n        }\r\n    }\r\n    TreeRenderer.prototype.updateOptions = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (typeof options.indent !== 'undefined') {\r\n            this.indent = clamp(options.indent, 0, 40);\r\n        }\r\n        if (typeof options.renderIndentGuides !== 'undefined') {\r\n            var shouldRenderIndentGuides = options.renderIndentGuides !== RenderIndentGuides.None;\r\n            if (shouldRenderIndentGuides !== this.shouldRenderIndentGuides) {\r\n                this.shouldRenderIndentGuides = shouldRenderIndentGuides;\r\n                this.indentGuidesDisposable.dispose();\r\n                if (shouldRenderIndentGuides) {\r\n                    var disposables = new DisposableStore();\r\n                    this.activeNodes.onDidChange(this._onDidChangeActiveNodes, this, disposables);\r\n                    this.indentGuidesDisposable = disposables;\r\n                    this._onDidChangeActiveNodes(this.activeNodes.elements);\r\n                }\r\n            }\r\n        }\r\n        if (typeof options.hideTwistiesOfChildlessElements !== 'undefined') {\r\n            this.hideTwistiesOfChildlessElements = options.hideTwistiesOfChildlessElements;\r\n        }\r\n    };\r\n    TreeRenderer.prototype.renderTemplate = function (container) {\r\n        var el = append(container, $('.monaco-tl-row'));\r\n        var indent = append(el, $('.monaco-tl-indent'));\r\n        var twistie = append(el, $('.monaco-tl-twistie'));\r\n        var contents = append(el, $('.monaco-tl-contents'));\r\n        var templateData = this.renderer.renderTemplate(contents);\r\n        return { container: container, indent: indent, twistie: twistie, indentGuidesDisposable: Disposable.None, templateData: templateData };\r\n    };\r\n    TreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\r\n        if (typeof height === 'number') {\r\n            this.renderedNodes.set(node, { templateData: templateData, height: height });\r\n            this.renderedElements.set(node.element, node);\r\n        }\r\n        var indent = TreeRenderer.DefaultIndent + (node.depth - 1) * this.indent;\r\n        templateData.twistie.style.paddingLeft = indent + \"px\";\r\n        templateData.indent.style.width = indent + this.indent - 16 + \"px\";\r\n        this.renderTwistie(node, templateData);\r\n        if (typeof height === 'number') {\r\n            this.renderIndentGuides(node, templateData);\r\n        }\r\n        this.renderer.renderElement(node, index, templateData.templateData, height);\r\n    };\r\n    TreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\r\n        templateData.indentGuidesDisposable.dispose();\r\n        if (this.renderer.disposeElement) {\r\n            this.renderer.disposeElement(node, index, templateData.templateData, height);\r\n        }\r\n        if (typeof height === 'number') {\r\n            this.renderedNodes.delete(node);\r\n            this.renderedElements.delete(node.element);\r\n        }\r\n    };\r\n    TreeRenderer.prototype.disposeTemplate = function (templateData) {\r\n        this.renderer.disposeTemplate(templateData.templateData);\r\n    };\r\n    TreeRenderer.prototype.onDidChangeTwistieState = function (element) {\r\n        var node = this.renderedElements.get(element);\r\n        if (!node) {\r\n            return;\r\n        }\r\n        this.onDidChangeNodeTwistieState(node);\r\n    };\r\n    TreeRenderer.prototype.onDidChangeNodeTwistieState = function (node) {\r\n        var data = this.renderedNodes.get(node);\r\n        if (!data) {\r\n            return;\r\n        }\r\n        this.renderTwistie(node, data.templateData);\r\n        this._onDidChangeActiveNodes(this.activeNodes.elements);\r\n        this.renderIndentGuides(node, data.templateData);\r\n    };\r\n    TreeRenderer.prototype.renderTwistie = function (node, templateData) {\r\n        if (this.renderer.renderTwistie) {\r\n            this.renderer.renderTwistie(node.element, templateData.twistie);\r\n        }\r\n        if (node.collapsible && (!this.hideTwistiesOfChildlessElements || node.visibleChildrenCount > 0)) {\r\n            addClasses(templateData.twistie, 'codicon', 'codicon-chevron-down', 'collapsible');\r\n            toggleClass(templateData.twistie, 'collapsed', node.collapsed);\r\n        }\r\n        else {\r\n            removeClasses(templateData.twistie, 'codicon', 'codicon-chevron-down', 'collapsible', 'collapsed');\r\n        }\r\n        if (node.collapsible) {\r\n            templateData.container.setAttribute('aria-expanded', String(!node.collapsed));\r\n        }\r\n        else {\r\n            templateData.container.removeAttribute('aria-expanded');\r\n        }\r\n    };\r\n    TreeRenderer.prototype.renderIndentGuides = function (target, templateData) {\r\n        var _this = this;\r\n        clearNode(templateData.indent);\r\n        templateData.indentGuidesDisposable.dispose();\r\n        if (!this.shouldRenderIndentGuides) {\r\n            return;\r\n        }\r\n        var disposableStore = new DisposableStore();\r\n        var model = this.modelProvider();\r\n        var node = target;\r\n        var _loop_1 = function () {\r\n            var ref = model.getNodeLocation(node);\r\n            var parentRef = model.getParentNodeLocation(ref);\r\n            if (!parentRef) {\r\n                return \"break\";\r\n            }\r\n            var parent_1 = model.getNode(parentRef);\r\n            var guide = $('.indent-guide', { style: \"width: \" + this_1.indent + \"px\" });\r\n            if (this_1.activeIndentNodes.has(parent_1)) {\r\n                addClass(guide, 'active');\r\n            }\r\n            if (templateData.indent.childElementCount === 0) {\r\n                templateData.indent.appendChild(guide);\r\n            }\r\n            else {\r\n                templateData.indent.insertBefore(guide, templateData.indent.firstElementChild);\r\n            }\r\n            this_1.renderedIndentGuides.add(parent_1, guide);\r\n            disposableStore.add(toDisposable(function () { return _this.renderedIndentGuides.delete(parent_1, guide); }));\r\n            node = parent_1;\r\n        };\r\n        var this_1 = this;\r\n        while (true) {\r\n            var state_1 = _loop_1();\r\n            if (state_1 === \"break\")\r\n                break;\r\n        }\r\n        templateData.indentGuidesDisposable = disposableStore;\r\n    };\r\n    TreeRenderer.prototype._onDidChangeActiveNodes = function (nodes) {\r\n        var _this = this;\r\n        if (!this.shouldRenderIndentGuides) {\r\n            return;\r\n        }\r\n        var set = new Set();\r\n        var model = this.modelProvider();\r\n        nodes.forEach(function (node) {\r\n            var ref = model.getNodeLocation(node);\r\n            try {\r\n                var parentRef = model.getParentNodeLocation(ref);\r\n                if (node.collapsible && node.children.length > 0 && !node.collapsed) {\r\n                    set.add(node);\r\n                }\r\n                else if (parentRef) {\r\n                    set.add(model.getNode(parentRef));\r\n                }\r\n            }\r\n            catch (_a) {\r\n                // noop\r\n            }\r\n        });\r\n        this.activeIndentNodes.forEach(function (node) {\r\n            if (!set.has(node)) {\r\n                _this.renderedIndentGuides.forEach(node, function (line) { return removeClass(line, 'active'); });\r\n            }\r\n        });\r\n        set.forEach(function (node) {\r\n            if (!_this.activeIndentNodes.has(node)) {\r\n                _this.renderedIndentGuides.forEach(node, function (line) { return addClass(line, 'active'); });\r\n            }\r\n        });\r\n        this.activeIndentNodes = set;\r\n    };\r\n    TreeRenderer.prototype.dispose = function () {\r\n        this.renderedNodes.clear();\r\n        this.renderedElements.clear();\r\n        this.indentGuidesDisposable.dispose();\r\n        dispose(this.disposables);\r\n    };\r\n    TreeRenderer.DefaultIndent = 8;\r\n    return TreeRenderer;\r\n}());\r\nvar TypeFilter = /** @class */ (function () {\r\n    function TypeFilter(tree, keyboardNavigationLabelProvider, _filter) {\r\n        this.tree = tree;\r\n        this.keyboardNavigationLabelProvider = keyboardNavigationLabelProvider;\r\n        this._filter = _filter;\r\n        this._totalCount = 0;\r\n        this._matchCount = 0;\r\n        this._pattern = '';\r\n        this._lowercasePattern = '';\r\n        this.disposables = new DisposableStore();\r\n        tree.onWillRefilter(this.reset, this, this.disposables);\r\n    }\r\n    Object.defineProperty(TypeFilter.prototype, \"totalCount\", {\r\n        get: function () { return this._totalCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilter.prototype, \"matchCount\", {\r\n        get: function () { return this._matchCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilter.prototype, \"pattern\", {\r\n        set: function (pattern) {\r\n            this._pattern = pattern;\r\n            this._lowercasePattern = pattern.toLowerCase();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    TypeFilter.prototype.filter = function (element, parentVisibility) {\r\n        if (this._filter) {\r\n            var result = this._filter.filter(element, parentVisibility);\r\n            if (this.tree.options.simpleKeyboardNavigation) {\r\n                return result;\r\n            }\r\n            var visibility = void 0;\r\n            if (typeof result === 'boolean') {\r\n                visibility = result ? 1 /* Visible */ : 0 /* Hidden */;\r\n            }\r\n            else if (isFilterResult(result)) {\r\n                visibility = getVisibleState(result.visibility);\r\n            }\r\n            else {\r\n                visibility = result;\r\n            }\r\n            if (visibility === 0 /* Hidden */) {\r\n                return false;\r\n            }\r\n        }\r\n        this._totalCount++;\r\n        if (this.tree.options.simpleKeyboardNavigation || !this._pattern) {\r\n            this._matchCount++;\r\n            return { data: FuzzyScore.Default, visibility: true };\r\n        }\r\n        var label = this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(element);\r\n        var labelStr = label && label.toString();\r\n        if (typeof labelStr === 'undefined') {\r\n            return { data: FuzzyScore.Default, visibility: true };\r\n        }\r\n        var score = fuzzyScore(this._pattern, this._lowercasePattern, 0, labelStr, labelStr.toLowerCase(), 0, true);\r\n        if (!score) {\r\n            if (this.tree.options.filterOnType) {\r\n                return 2 /* Recurse */;\r\n            }\r\n            else {\r\n                return { data: FuzzyScore.Default, visibility: true };\r\n            }\r\n            // DEMO: smarter filter ?\r\n            // return parentVisibility === TreeVisibility.Visible ? true : TreeVisibility.Recurse;\r\n        }\r\n        this._matchCount++;\r\n        return { data: score, visibility: true };\r\n    };\r\n    TypeFilter.prototype.reset = function () {\r\n        this._totalCount = 0;\r\n        this._matchCount = 0;\r\n    };\r\n    TypeFilter.prototype.dispose = function () {\r\n        dispose(this.disposables);\r\n    };\r\n    return TypeFilter;\r\n}());\r\nvar TypeFilterController = /** @class */ (function () {\r\n    function TypeFilterController(tree, model, view, filter, keyboardNavigationDelegate) {\r\n        this.tree = tree;\r\n        this.view = view;\r\n        this.filter = filter;\r\n        this.keyboardNavigationDelegate = keyboardNavigationDelegate;\r\n        this._enabled = false;\r\n        this._pattern = '';\r\n        this._empty = false;\r\n        this._onDidChangeEmptyState = new Emitter();\r\n        this.positionClassName = 'ne';\r\n        this.automaticKeyboardNavigation = true;\r\n        this.triggered = false;\r\n        this._onDidChangePattern = new Emitter();\r\n        this.enabledDisposables = new DisposableStore();\r\n        this.disposables = new DisposableStore();\r\n        this.domNode = $(\".monaco-list-type-filter.\" + this.positionClassName);\r\n        this.domNode.draggable = true;\r\n        domEvent(this.domNode, 'dragstart')(this.onDragStart, this, this.disposables);\r\n        this.messageDomNode = append(view.getHTMLElement(), $(\".monaco-list-type-filter-message\"));\r\n        this.labelDomNode = append(this.domNode, $('span.label'));\r\n        var controls = append(this.domNode, $('.controls'));\r\n        this._filterOnType = !!tree.options.filterOnType;\r\n        this.filterOnTypeDomNode = append(controls, $('input.filter.codicon.codicon-list-selection'));\r\n        this.filterOnTypeDomNode.type = 'checkbox';\r\n        this.filterOnTypeDomNode.checked = this._filterOnType;\r\n        this.filterOnTypeDomNode.tabIndex = -1;\r\n        this.updateFilterOnTypeTitle();\r\n        domEvent(this.filterOnTypeDomNode, 'input')(this.onDidChangeFilterOnType, this, this.disposables);\r\n        this.clearDomNode = append(controls, $('button.clear.codicon.codicon-close'));\r\n        this.clearDomNode.tabIndex = -1;\r\n        this.clearDomNode.title = localize('clear', \"Clear\");\r\n        this.keyboardNavigationEventFilter = tree.options.keyboardNavigationEventFilter;\r\n        model.onDidSplice(this.onDidSpliceModel, this, this.disposables);\r\n        this.updateOptions(tree.options);\r\n    }\r\n    Object.defineProperty(TypeFilterController.prototype, \"enabled\", {\r\n        get: function () { return this._enabled; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilterController.prototype, \"pattern\", {\r\n        get: function () { return this._pattern; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilterController.prototype, \"filterOnType\", {\r\n        get: function () { return this._filterOnType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    TypeFilterController.prototype.updateOptions = function (options) {\r\n        if (options.simpleKeyboardNavigation) {\r\n            this.disable();\r\n        }\r\n        else {\r\n            this.enable();\r\n        }\r\n        if (typeof options.filterOnType !== 'undefined') {\r\n            this._filterOnType = !!options.filterOnType;\r\n            this.filterOnTypeDomNode.checked = this._filterOnType;\r\n        }\r\n        if (typeof options.automaticKeyboardNavigation !== 'undefined') {\r\n            this.automaticKeyboardNavigation = options.automaticKeyboardNavigation;\r\n        }\r\n        this.tree.refilter();\r\n        this.render();\r\n        if (!this.automaticKeyboardNavigation) {\r\n            this.onEventOrInput('');\r\n        }\r\n    };\r\n    TypeFilterController.prototype.enable = function () {\r\n        var _this = this;\r\n        if (this._enabled) {\r\n            return;\r\n        }\r\n        var onKeyDown = Event.chain(domEvent(this.view.getHTMLElement(), 'keydown'))\r\n            .filter(function (e) { return !isInputElement(e.target) || e.target === _this.filterOnTypeDomNode; })\r\n            .filter(function (e) { return e.key !== 'Dead' && !/^Media/.test(e.key); })\r\n            .map(function (e) { return new StandardKeyboardEvent(e); })\r\n            .filter(this.keyboardNavigationEventFilter || (function () { return true; }))\r\n            .filter(function () { return _this.automaticKeyboardNavigation || _this.triggered; })\r\n            .filter(function (e) { return _this.keyboardNavigationDelegate.mightProducePrintableCharacter(e) || ((_this.pattern.length > 0 || _this.triggered) && ((e.keyCode === 9 /* Escape */ || e.keyCode === 1 /* Backspace */) && !e.altKey && !e.ctrlKey && !e.metaKey) || (e.keyCode === 1 /* Backspace */ && (isMacintosh ? (e.altKey && !e.metaKey) : e.ctrlKey) && !e.shiftKey)); })\r\n            .forEach(function (e) { e.stopPropagation(); e.preventDefault(); })\r\n            .event;\r\n        var onClear = domEvent(this.clearDomNode, 'click');\r\n        Event.chain(Event.any(onKeyDown, onClear))\r\n            .event(this.onEventOrInput, this, this.enabledDisposables);\r\n        this.filter.pattern = '';\r\n        this.tree.refilter();\r\n        this.render();\r\n        this._enabled = true;\r\n        this.triggered = false;\r\n    };\r\n    TypeFilterController.prototype.disable = function () {\r\n        if (!this._enabled) {\r\n            return;\r\n        }\r\n        this.domNode.remove();\r\n        this.enabledDisposables.clear();\r\n        this.tree.refilter();\r\n        this.render();\r\n        this._enabled = false;\r\n        this.triggered = false;\r\n    };\r\n    TypeFilterController.prototype.onEventOrInput = function (e) {\r\n        if (typeof e === 'string') {\r\n            this.onInput(e);\r\n        }\r\n        else if (e instanceof MouseEvent || e.keyCode === 9 /* Escape */ || (e.keyCode === 1 /* Backspace */ && (isMacintosh ? e.altKey : e.ctrlKey))) {\r\n            this.onInput('');\r\n        }\r\n        else if (e.keyCode === 1 /* Backspace */) {\r\n            this.onInput(this.pattern.length === 0 ? '' : this.pattern.substr(0, this.pattern.length - 1));\r\n        }\r\n        else {\r\n            this.onInput(this.pattern + e.browserEvent.key);\r\n        }\r\n    };\r\n    TypeFilterController.prototype.onInput = function (pattern) {\r\n        var container = this.view.getHTMLElement();\r\n        if (pattern && !this.domNode.parentElement) {\r\n            container.append(this.domNode);\r\n        }\r\n        else if (!pattern && this.domNode.parentElement) {\r\n            this.domNode.remove();\r\n            this.tree.domFocus();\r\n        }\r\n        this._pattern = pattern;\r\n        this._onDidChangePattern.fire(pattern);\r\n        this.filter.pattern = pattern;\r\n        this.tree.refilter();\r\n        if (pattern) {\r\n            this.tree.focusNext(0, true, undefined, function (node) { return !FuzzyScore.isDefault(node.filterData); });\r\n        }\r\n        var focus = this.tree.getFocus();\r\n        if (focus.length > 0) {\r\n            var element = focus[0];\r\n            if (this.tree.getRelativeTop(element) === null) {\r\n                this.tree.reveal(element, 0.5);\r\n            }\r\n        }\r\n        this.render();\r\n        if (!pattern) {\r\n            this.triggered = false;\r\n        }\r\n    };\r\n    TypeFilterController.prototype.onDragStart = function () {\r\n        var _this = this;\r\n        var container = this.view.getHTMLElement();\r\n        var left = getDomNodePagePosition(container).left;\r\n        var containerWidth = container.clientWidth;\r\n        var midContainerWidth = containerWidth / 2;\r\n        var width = this.domNode.clientWidth;\r\n        var disposables = new DisposableStore();\r\n        var positionClassName = this.positionClassName;\r\n        var updatePosition = function () {\r\n            switch (positionClassName) {\r\n                case 'nw':\r\n                    _this.domNode.style.top = \"4px\";\r\n                    _this.domNode.style.left = \"4px\";\r\n                    break;\r\n                case 'ne':\r\n                    _this.domNode.style.top = \"4px\";\r\n                    _this.domNode.style.left = containerWidth - width - 6 + \"px\";\r\n                    break;\r\n            }\r\n        };\r\n        var onDragOver = function (event) {\r\n            event.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\r\n            var x = event.screenX - left;\r\n            if (event.dataTransfer) {\r\n                event.dataTransfer.dropEffect = 'none';\r\n            }\r\n            if (x < midContainerWidth) {\r\n                positionClassName = 'nw';\r\n            }\r\n            else {\r\n                positionClassName = 'ne';\r\n            }\r\n            updatePosition();\r\n        };\r\n        var onDragEnd = function () {\r\n            _this.positionClassName = positionClassName;\r\n            _this.domNode.className = \"monaco-list-type-filter \" + _this.positionClassName;\r\n            _this.domNode.style.top = '';\r\n            _this.domNode.style.left = '';\r\n            dispose(disposables);\r\n        };\r\n        updatePosition();\r\n        removeClass(this.domNode, positionClassName);\r\n        addClass(this.domNode, 'dragging');\r\n        disposables.add(toDisposable(function () { return removeClass(_this.domNode, 'dragging'); }));\r\n        domEvent(document, 'dragover')(onDragOver, null, disposables);\r\n        domEvent(this.domNode, 'dragend')(onDragEnd, null, disposables);\r\n        StaticDND.CurrentDragAndDropData = new DragAndDropData('vscode-ui');\r\n        disposables.add(toDisposable(function () { return StaticDND.CurrentDragAndDropData = undefined; }));\r\n    };\r\n    TypeFilterController.prototype.onDidSpliceModel = function () {\r\n        if (!this._enabled || this.pattern.length === 0) {\r\n            return;\r\n        }\r\n        this.tree.refilter();\r\n        this.render();\r\n    };\r\n    TypeFilterController.prototype.onDidChangeFilterOnType = function () {\r\n        this.tree.updateOptions({ filterOnType: this.filterOnTypeDomNode.checked });\r\n        this.tree.refilter();\r\n        this.tree.domFocus();\r\n        this.render();\r\n        this.updateFilterOnTypeTitle();\r\n    };\r\n    TypeFilterController.prototype.updateFilterOnTypeTitle = function () {\r\n        if (this.filterOnType) {\r\n            this.filterOnTypeDomNode.title = localize('disable filter on type', \"Disable Filter on Type\");\r\n        }\r\n        else {\r\n            this.filterOnTypeDomNode.title = localize('enable filter on type', \"Enable Filter on Type\");\r\n        }\r\n    };\r\n    TypeFilterController.prototype.render = function () {\r\n        var noMatches = this.filter.totalCount > 0 && this.filter.matchCount === 0;\r\n        if (this.pattern && this.tree.options.filterOnType && noMatches) {\r\n            this.messageDomNode.textContent = localize('empty', \"No elements found\");\r\n            this._empty = true;\r\n        }\r\n        else {\r\n            this.messageDomNode.innerHTML = '';\r\n            this._empty = false;\r\n        }\r\n        toggleClass(this.domNode, 'no-matches', noMatches);\r\n        this.domNode.title = localize('found', \"Matched {0} out of {1} elements\", this.filter.matchCount, this.filter.totalCount);\r\n        this.labelDomNode.textContent = this.pattern.length > 16 ? 'â€¦' + this.pattern.substr(this.pattern.length - 16) : this.pattern;\r\n        this._onDidChangeEmptyState.fire(this._empty);\r\n    };\r\n    TypeFilterController.prototype.shouldAllowFocus = function (node) {\r\n        if (!this.enabled || !this.pattern || this.filterOnType) {\r\n            return true;\r\n        }\r\n        if (this.filter.totalCount > 0 && this.filter.matchCount <= 1) {\r\n            return true;\r\n        }\r\n        return !FuzzyScore.isDefault(node.filterData);\r\n    };\r\n    TypeFilterController.prototype.dispose = function () {\r\n        if (this._enabled) {\r\n            this.domNode.remove();\r\n            this.enabledDisposables.dispose();\r\n            this._enabled = false;\r\n            this.triggered = false;\r\n        }\r\n        this._onDidChangePattern.dispose();\r\n        dispose(this.disposables);\r\n    };\r\n    return TypeFilterController;\r\n}());\r\nfunction isInputElement(e) {\r\n    return e.tagName === 'INPUT' || e.tagName === 'TEXTAREA';\r\n}\r\nfunction asTreeEvent(event) {\r\n    return {\r\n        elements: event.elements.map(function (node) { return node.element; }),\r\n        browserEvent: event.browserEvent\r\n    };\r\n}\r\nfunction dfs(node, fn) {\r\n    fn(node);\r\n    node.children.forEach(function (child) { return dfs(child, fn); });\r\n}\r\n/**\r\n * The trait concept needs to exist at the tree level, because collapsed\r\n * tree nodes will not be known by the list.\r\n */\r\nvar Trait = /** @class */ (function () {\r\n    function Trait(identityProvider) {\r\n        this.identityProvider = identityProvider;\r\n        this.nodes = [];\r\n        this._onDidChange = new Emitter();\r\n        this.onDidChange = this._onDidChange.event;\r\n    }\r\n    Object.defineProperty(Trait.prototype, \"nodeSet\", {\r\n        get: function () {\r\n            if (!this._nodeSet) {\r\n                this._nodeSet = this.createNodeSet();\r\n            }\r\n            return this._nodeSet;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Trait.prototype.set = function (nodes, browserEvent) {\r\n        if (equals(this.nodes, nodes)) {\r\n            return;\r\n        }\r\n        this._set(nodes, false, browserEvent);\r\n    };\r\n    Trait.prototype._set = function (nodes, silent, browserEvent) {\r\n        this.nodes = __spreadArrays(nodes);\r\n        this.elements = undefined;\r\n        this._nodeSet = undefined;\r\n        if (!silent) {\r\n            var that_1 = this;\r\n            this._onDidChange.fire({ get elements() { return that_1.get(); }, browserEvent: browserEvent });\r\n        }\r\n    };\r\n    Trait.prototype.get = function () {\r\n        if (!this.elements) {\r\n            this.elements = this.nodes.map(function (node) { return node.element; });\r\n        }\r\n        return __spreadArrays(this.elements);\r\n    };\r\n    Trait.prototype.getNodes = function () {\r\n        return this.nodes;\r\n    };\r\n    Trait.prototype.has = function (node) {\r\n        return this.nodeSet.has(node);\r\n    };\r\n    Trait.prototype.onDidModelSplice = function (_a) {\r\n        var _this = this;\r\n        var insertedNodes = _a.insertedNodes, deletedNodes = _a.deletedNodes;\r\n        if (!this.identityProvider) {\r\n            var set_1 = this.createNodeSet();\r\n            var visit_1 = function (node) { return set_1.delete(node); };\r\n            deletedNodes.forEach(function (node) { return dfs(node, visit_1); });\r\n            this.set(values(set_1));\r\n            return;\r\n        }\r\n        var deletedNodesIdSet = new Set();\r\n        var deletedNodesVisitor = function (node) { return deletedNodesIdSet.add(_this.identityProvider.getId(node.element).toString()); };\r\n        deletedNodes.forEach(function (node) { return dfs(node, deletedNodesVisitor); });\r\n        var insertedNodesMap = new Map();\r\n        var insertedNodesVisitor = function (node) { return insertedNodesMap.set(_this.identityProvider.getId(node.element).toString(), node); };\r\n        insertedNodes.forEach(function (node) { return dfs(node, insertedNodesVisitor); });\r\n        var nodes = [];\r\n        for (var _i = 0, _b = this.nodes; _i < _b.length; _i++) {\r\n            var node = _b[_i];\r\n            var id = this.identityProvider.getId(node.element).toString();\r\n            var wasDeleted = deletedNodesIdSet.has(id);\r\n            if (!wasDeleted) {\r\n                nodes.push(node);\r\n            }\r\n            else {\r\n                var insertedNode = insertedNodesMap.get(id);\r\n                if (insertedNode) {\r\n                    nodes.push(insertedNode);\r\n                }\r\n            }\r\n        }\r\n        this._set(nodes, true);\r\n    };\r\n    Trait.prototype.createNodeSet = function () {\r\n        var set = new Set();\r\n        for (var _i = 0, _a = this.nodes; _i < _a.length; _i++) {\r\n            var node = _a[_i];\r\n            set.add(node);\r\n        }\r\n        return set;\r\n    };\r\n    return Trait;\r\n}());\r\nvar TreeNodeListMouseController = /** @class */ (function (_super) {\r\n    __extends(TreeNodeListMouseController, _super);\r\n    function TreeNodeListMouseController(list, tree) {\r\n        var _this = _super.call(this, list) || this;\r\n        _this.tree = tree;\r\n        return _this;\r\n    }\r\n    TreeNodeListMouseController.prototype.onPointer = function (e) {\r\n        if (isInputElement(e.browserEvent.target)) {\r\n            return;\r\n        }\r\n        var node = e.element;\r\n        if (!node) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        if (this.isSelectionRangeChangeEvent(e) || this.isSelectionSingleChangeEvent(e)) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        var onTwistie = hasClass(e.browserEvent.target, 'monaco-tl-twistie');\r\n        if (!this.tree.openOnSingleClick && e.browserEvent.detail !== 2 && !onTwistie) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        var expandOnlyOnTwistieClick = false;\r\n        if (typeof this.tree.expandOnlyOnTwistieClick === 'function') {\r\n            expandOnlyOnTwistieClick = this.tree.expandOnlyOnTwistieClick(node.element);\r\n        }\r\n        else {\r\n            expandOnlyOnTwistieClick = !!this.tree.expandOnlyOnTwistieClick;\r\n        }\r\n        if (expandOnlyOnTwistieClick && !onTwistie) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        if (node.collapsible) {\r\n            var model = this.tree.model; // internal\r\n            var location_1 = model.getNodeLocation(node);\r\n            var recursive = e.browserEvent.altKey;\r\n            model.setCollapsed(location_1, undefined, recursive);\r\n            if (expandOnlyOnTwistieClick && onTwistie) {\r\n                return;\r\n            }\r\n        }\r\n        _super.prototype.onPointer.call(this, e);\r\n    };\r\n    TreeNodeListMouseController.prototype.onDoubleClick = function (e) {\r\n        var onTwistie = hasClass(e.browserEvent.target, 'monaco-tl-twistie');\r\n        if (onTwistie) {\r\n            return;\r\n        }\r\n        _super.prototype.onDoubleClick.call(this, e);\r\n    };\r\n    return TreeNodeListMouseController;\r\n}(MouseController));\r\n/**\r\n * We use this List subclass to restore selection and focus as nodes\r\n * get rendered in the list, possibly due to a node expand() call.\r\n */\r\nvar TreeNodeList = /** @class */ (function (_super) {\r\n    __extends(TreeNodeList, _super);\r\n    function TreeNodeList(user, container, virtualDelegate, renderers, focusTrait, selectionTrait, options) {\r\n        var _this = _super.call(this, user, container, virtualDelegate, renderers, options) || this;\r\n        _this.focusTrait = focusTrait;\r\n        _this.selectionTrait = selectionTrait;\r\n        return _this;\r\n    }\r\n    TreeNodeList.prototype.createMouseController = function (options) {\r\n        return new TreeNodeListMouseController(this, options.tree);\r\n    };\r\n    TreeNodeList.prototype.splice = function (start, deleteCount, elements) {\r\n        var _this = this;\r\n        if (elements === void 0) { elements = []; }\r\n        _super.prototype.splice.call(this, start, deleteCount, elements);\r\n        if (elements.length === 0) {\r\n            return;\r\n        }\r\n        var additionalFocus = [];\r\n        var additionalSelection = [];\r\n        elements.forEach(function (node, index) {\r\n            if (_this.focusTrait.has(node)) {\r\n                additionalFocus.push(start + index);\r\n            }\r\n            if (_this.selectionTrait.has(node)) {\r\n                additionalSelection.push(start + index);\r\n            }\r\n        });\r\n        if (additionalFocus.length > 0) {\r\n            _super.prototype.setFocus.call(this, distinctES6(__spreadArrays(_super.prototype.getFocus.call(this), additionalFocus)));\r\n        }\r\n        if (additionalSelection.length > 0) {\r\n            _super.prototype.setSelection.call(this, distinctES6(__spreadArrays(_super.prototype.getSelection.call(this), additionalSelection)));\r\n        }\r\n    };\r\n    TreeNodeList.prototype.setFocus = function (indexes, browserEvent, fromAPI) {\r\n        var _this = this;\r\n        if (fromAPI === void 0) { fromAPI = false; }\r\n        _super.prototype.setFocus.call(this, indexes, browserEvent);\r\n        if (!fromAPI) {\r\n            this.focusTrait.set(indexes.map(function (i) { return _this.element(i); }), browserEvent);\r\n        }\r\n    };\r\n    TreeNodeList.prototype.setSelection = function (indexes, browserEvent, fromAPI) {\r\n        var _this = this;\r\n        if (fromAPI === void 0) { fromAPI = false; }\r\n        _super.prototype.setSelection.call(this, indexes, browserEvent);\r\n        if (!fromAPI) {\r\n            this.selectionTrait.set(indexes.map(function (i) { return _this.element(i); }), browserEvent);\r\n        }\r\n    };\r\n    return TreeNodeList;\r\n}(List));\r\nvar AbstractTree = /** @class */ (function () {\r\n    function AbstractTree(user, container, delegate, renderers, _options) {\r\n        var _this = this;\r\n        if (_options === void 0) { _options = {}; }\r\n        this._options = _options;\r\n        this.eventBufferer = new EventBufferer();\r\n        this.disposables = new DisposableStore();\r\n        this._onWillRefilter = new Emitter();\r\n        this.onWillRefilter = this._onWillRefilter.event;\r\n        this._onDidUpdateOptions = new Emitter();\r\n        var treeDelegate = new ComposedTreeDelegate(delegate);\r\n        var onDidChangeCollapseStateRelay = new Relay();\r\n        var onDidChangeActiveNodes = new Relay();\r\n        var activeNodes = new EventCollection(onDidChangeActiveNodes.event);\r\n        this.renderers = renderers.map(function (r) { return new TreeRenderer(r, function () { return _this.model; }, onDidChangeCollapseStateRelay.event, activeNodes, _options); });\r\n        for (var _i = 0, _a = this.renderers; _i < _a.length; _i++) {\r\n            var r = _a[_i];\r\n            this.disposables.add(r);\r\n        }\r\n        var filter;\r\n        if (_options.keyboardNavigationLabelProvider) {\r\n            filter = new TypeFilter(this, _options.keyboardNavigationLabelProvider, _options.filter);\r\n            _options = __assign(__assign({}, _options), { filter: filter }); // TODO need typescript help here\r\n            this.disposables.add(filter);\r\n        }\r\n        this.focus = new Trait(_options.identityProvider);\r\n        this.selection = new Trait(_options.identityProvider);\r\n        this.view = new TreeNodeList(user, container, treeDelegate, this.renderers, this.focus, this.selection, __assign(__assign({}, asListOptions(function () { return _this.model; }, _options)), { tree: this }));\r\n        this.model = this.createModel(user, this.view, _options);\r\n        onDidChangeCollapseStateRelay.input = this.model.onDidChangeCollapseState;\r\n        var onDidModelSplice = Event.forEach(this.model.onDidSplice, function (e) {\r\n            _this.eventBufferer.bufferEvents(function () {\r\n                _this.focus.onDidModelSplice(e);\r\n                _this.selection.onDidModelSplice(e);\r\n            });\r\n        });\r\n        // Make sure the `forEach` always runs\r\n        onDidModelSplice(function () { return null; }, null, this.disposables);\r\n        // Active nodes can change when the model changes or when focus or selection change.\r\n        // We debounce it with 0 delay since these events may fire in the same stack and we only\r\n        // want to run this once. It also doesn't matter if it runs on the next tick since it's only\r\n        // a nice to have UI feature.\r\n        onDidChangeActiveNodes.input = Event.chain(Event.any(onDidModelSplice, this.focus.onDidChange, this.selection.onDidChange))\r\n            .debounce(function () { return null; }, 0)\r\n            .map(function () {\r\n            var set = new Set();\r\n            for (var _i = 0, _a = _this.focus.getNodes(); _i < _a.length; _i++) {\r\n                var node = _a[_i];\r\n                set.add(node);\r\n            }\r\n            for (var _b = 0, _c = _this.selection.getNodes(); _b < _c.length; _b++) {\r\n                var node = _c[_b];\r\n                set.add(node);\r\n            }\r\n            return fromSet(set);\r\n        }).event;\r\n        if (_options.keyboardSupport !== false) {\r\n            var onKeyDown = Event.chain(this.view.onKeyDown)\r\n                .filter(function (e) { return !isInputElement(e.target); })\r\n                .map(function (e) { return new StandardKeyboardEvent(e); });\r\n            onKeyDown.filter(function (e) { return e.keyCode === 15 /* LeftArrow */; }).on(this.onLeftArrow, this, this.disposables);\r\n            onKeyDown.filter(function (e) { return e.keyCode === 17 /* RightArrow */; }).on(this.onRightArrow, this, this.disposables);\r\n            onKeyDown.filter(function (e) { return e.keyCode === 10 /* Space */; }).on(this.onSpace, this, this.disposables);\r\n        }\r\n        if (_options.keyboardNavigationLabelProvider) {\r\n            var delegate_1 = _options.keyboardNavigationDelegate || DefaultKeyboardNavigationDelegate;\r\n            this.typeFilterController = new TypeFilterController(this, this.model, this.view, filter, delegate_1);\r\n            this.focusNavigationFilter = function (node) { return _this.typeFilterController.shouldAllowFocus(node); };\r\n            this.disposables.add(this.typeFilterController);\r\n        }\r\n        this.styleElement = createStyleSheet(this.view.getHTMLElement());\r\n        toggleClass(this.getHTMLElement(), 'always', this._options.renderIndentGuides === RenderIndentGuides.Always);\r\n    }\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidChangeFocus\", {\r\n        get: function () { return this.eventBufferer.wrapEvent(this.focus.onDidChange); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidChangeSelection\", {\r\n        get: function () { return this.eventBufferer.wrapEvent(this.selection.onDidChange); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidOpen\", {\r\n        get: function () { return Event.map(this.view.onDidOpen, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidFocus\", {\r\n        get: function () { return this.view.onDidFocus; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidChangeCollapseState\", {\r\n        get: function () { return this.model.onDidChangeCollapseState; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"openOnSingleClick\", {\r\n        get: function () { return typeof this._options.openOnSingleClick === 'undefined' ? true : this._options.openOnSingleClick; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"expandOnlyOnTwistieClick\", {\r\n        get: function () { return typeof this._options.expandOnlyOnTwistieClick === 'undefined' ? false : this._options.expandOnlyOnTwistieClick; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidDispose\", {\r\n        get: function () { return this.view.onDidDispose; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AbstractTree.prototype.updateOptions = function (optionsUpdate) {\r\n        if (optionsUpdate === void 0) { optionsUpdate = {}; }\r\n        this._options = __assign(__assign({}, this._options), optionsUpdate);\r\n        for (var _i = 0, _a = this.renderers; _i < _a.length; _i++) {\r\n            var renderer = _a[_i];\r\n            renderer.updateOptions(optionsUpdate);\r\n        }\r\n        this.view.updateOptions({\r\n            enableKeyboardNavigation: this._options.simpleKeyboardNavigation,\r\n            automaticKeyboardNavigation: this._options.automaticKeyboardNavigation\r\n        });\r\n        if (this.typeFilterController) {\r\n            this.typeFilterController.updateOptions(this._options);\r\n        }\r\n        this._onDidUpdateOptions.fire(this._options);\r\n        toggleClass(this.getHTMLElement(), 'always', this._options.renderIndentGuides === RenderIndentGuides.Always);\r\n    };\r\n    Object.defineProperty(AbstractTree.prototype, \"options\", {\r\n        get: function () {\r\n            return this._options;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    // Widget\r\n    AbstractTree.prototype.getHTMLElement = function () {\r\n        return this.view.getHTMLElement();\r\n    };\r\n    Object.defineProperty(AbstractTree.prototype, \"scrollTop\", {\r\n        get: function () {\r\n            return this.view.scrollTop;\r\n        },\r\n        set: function (scrollTop) {\r\n            this.view.scrollTop = scrollTop;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AbstractTree.prototype.domFocus = function () {\r\n        this.view.domFocus();\r\n    };\r\n    AbstractTree.prototype.layout = function (height, width) {\r\n        this.view.layout(height, width);\r\n    };\r\n    AbstractTree.prototype.style = function (styles) {\r\n        var suffix = \".\" + this.view.domId;\r\n        var content = [];\r\n        if (styles.treeIndentGuidesStroke) {\r\n            content.push(\".monaco-list\" + suffix + \":hover .monaco-tl-indent > .indent-guide, .monaco-list\" + suffix + \".always .monaco-tl-indent > .indent-guide  { border-color: \" + styles.treeIndentGuidesStroke.transparent(0.4) + \"; }\");\r\n            content.push(\".monaco-list\" + suffix + \" .monaco-tl-indent > .indent-guide.active { border-color: \" + styles.treeIndentGuidesStroke + \"; }\");\r\n        }\r\n        var newStyles = content.join('\\n');\r\n        if (newStyles !== this.styleElement.innerHTML) {\r\n            this.styleElement.innerHTML = newStyles;\r\n        }\r\n        this.view.style(styles);\r\n    };\r\n    AbstractTree.prototype.collapse = function (location, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        return this.model.setCollapsed(location, true, recursive);\r\n    };\r\n    AbstractTree.prototype.expand = function (location, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        return this.model.setCollapsed(location, false, recursive);\r\n    };\r\n    AbstractTree.prototype.isCollapsible = function (location) {\r\n        return this.model.isCollapsible(location);\r\n    };\r\n    AbstractTree.prototype.setCollapsible = function (location, collapsible) {\r\n        return this.model.setCollapsible(location, collapsible);\r\n    };\r\n    AbstractTree.prototype.isCollapsed = function (location) {\r\n        return this.model.isCollapsed(location);\r\n    };\r\n    AbstractTree.prototype.refilter = function () {\r\n        this._onWillRefilter.fire(undefined);\r\n        this.model.refilter();\r\n    };\r\n    AbstractTree.prototype.setSelection = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.model.getNode(e); });\r\n        this.selection.set(nodes, browserEvent);\r\n        var indexes = elements.map(function (e) { return _this.model.getListIndex(e); }).filter(function (i) { return i > -1; });\r\n        this.view.setSelection(indexes, browserEvent, true);\r\n    };\r\n    AbstractTree.prototype.getSelection = function () {\r\n        return this.selection.get();\r\n    };\r\n    AbstractTree.prototype.setFocus = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.model.getNode(e); });\r\n        this.focus.set(nodes, browserEvent);\r\n        var indexes = elements.map(function (e) { return _this.model.getListIndex(e); }).filter(function (i) { return i > -1; });\r\n        this.view.setFocus(indexes, browserEvent, true);\r\n    };\r\n    AbstractTree.prototype.focusNext = function (n, loop, browserEvent, filter) {\r\n        if (n === void 0) { n = 1; }\r\n        if (loop === void 0) { loop = false; }\r\n        if (filter === void 0) { filter = this.focusNavigationFilter; }\r\n        this.view.focusNext(n, loop, browserEvent, filter);\r\n    };\r\n    AbstractTree.prototype.getFocus = function () {\r\n        return this.focus.get();\r\n    };\r\n    AbstractTree.prototype.reveal = function (location, relativeTop) {\r\n        this.model.expandTo(location);\r\n        var index = this.model.getListIndex(location);\r\n        if (index === -1) {\r\n            return;\r\n        }\r\n        this.view.reveal(index, relativeTop);\r\n    };\r\n    /**\r\n     * Returns the relative position of an element rendered in the list.\r\n     * Returns `null` if the element isn't *entirely* in the visible viewport.\r\n     */\r\n    AbstractTree.prototype.getRelativeTop = function (location) {\r\n        var index = this.model.getListIndex(location);\r\n        if (index === -1) {\r\n            return null;\r\n        }\r\n        return this.view.getRelativeTop(index);\r\n    };\r\n    // List\r\n    AbstractTree.prototype.onLeftArrow = function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        var nodes = this.view.getFocusedElements();\r\n        if (nodes.length === 0) {\r\n            return;\r\n        }\r\n        var node = nodes[0];\r\n        var location = this.model.getNodeLocation(node);\r\n        var didChange = this.model.setCollapsed(location, true);\r\n        if (!didChange) {\r\n            var parentLocation = this.model.getParentNodeLocation(location);\r\n            if (!parentLocation) {\r\n                return;\r\n            }\r\n            var parentListIndex = this.model.getListIndex(parentLocation);\r\n            this.view.reveal(parentListIndex);\r\n            this.view.setFocus([parentListIndex]);\r\n        }\r\n    };\r\n    AbstractTree.prototype.onRightArrow = function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        var nodes = this.view.getFocusedElements();\r\n        if (nodes.length === 0) {\r\n            return;\r\n        }\r\n        var node = nodes[0];\r\n        var location = this.model.getNodeLocation(node);\r\n        var didChange = this.model.setCollapsed(location, false);\r\n        if (!didChange) {\r\n            if (!node.children.some(function (child) { return child.visible; })) {\r\n                return;\r\n            }\r\n            var focusedIndex = this.view.getFocus()[0];\r\n            var firstChildIndex = focusedIndex + 1;\r\n            this.view.reveal(firstChildIndex);\r\n            this.view.setFocus([firstChildIndex]);\r\n        }\r\n    };\r\n    AbstractTree.prototype.onSpace = function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        var nodes = this.view.getFocusedElements();\r\n        if (nodes.length === 0) {\r\n            return;\r\n        }\r\n        var node = nodes[0];\r\n        var location = this.model.getNodeLocation(node);\r\n        var recursive = e.browserEvent.altKey;\r\n        this.model.setCollapsed(location, undefined, recursive);\r\n    };\r\n    AbstractTree.prototype.dispose = function () {\r\n        dispose(this.disposables);\r\n        this.view.dispose();\r\n    };\r\n    return AbstractTree;\r\n}());\r\nexport { AbstractTree };\r\n"]},"metadata":{},"sourceType":"module"}